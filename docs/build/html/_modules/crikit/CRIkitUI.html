
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>crikit.CRIkitUI &#8212; CRIKit2 0.2.2 documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CRIKit2 0.2.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for crikit.CRIkitUI</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CRIKit2: Hyperspectral imaging toolkit</span>
<span class="sd">======================================</span>

<span class="sd">CRIKit2, formerly the Coherent Raman Imaging toolKit, is a hyperspectral</span>
<span class="sd">imaging (HSI) platform (user interface, UI).</span>

<span class="sd">HSI Processing:</span>
<span class="sd">    * Dark subtraction</span>
<span class="sd">    * Detrending</span>
<span class="sd">    * Denoising</span>

<span class="sd">Coherent Raman-Specific Processing:</span>
<span class="sd">    * Kramers-Kronig phase retrieval</span>
<span class="sd">    * Phase- and scale-error correction</span>

<span class="sd">Analysis:</span>
<span class="sd">    * Coming soon</span>

<span class="sd">Usage</span>
<span class="sd">-----</span>
<span class="sd">From ./crikit2 directory</span>
<span class="sd">python3 main.py</span>

<span class="sd">Authors</span>
<span class="sd">-------</span>
<span class="sd">* Charles H. Camp Jr. &lt;charles.camp@nist.gov&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span> <span class="k">as</span> <span class="nn">_copy</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="k">as</span> <span class="nn">_os</span>
<span class="kn">import</span> <span class="nn">sys</span> <span class="k">as</span> <span class="nn">_sys</span>
<span class="kn">import</span> <span class="nn">traceback</span> <span class="k">as</span> <span class="nn">_traceback</span>
<span class="kn">import</span> <span class="nn">webbrowser</span> <span class="k">as</span> <span class="nn">_webbrowser</span>


<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">_mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">_plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">_np</span>
<span class="kn">import</span> <span class="nn">h5py</span> <span class="k">as</span> <span class="nn">_h5py</span>

<span class="kn">import</span> <span class="nn">PyQt5.QtCore</span> <span class="k">as</span> <span class="nn">_QtCore</span>

<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="k">import</span> <span class="n">QCursor</span> <span class="k">as</span> <span class="n">_QCursor</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QApplication</span> <span class="k">as</span> <span class="n">_QApplication</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QFileDialog</span> <span class="k">as</span> <span class="n">_QFileDialog</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QInputDialog</span> <span class="k">as</span> <span class="n">_QInputDialog</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QMainWindow</span> <span class="k">as</span> <span class="n">_QMainWindow</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QMessageBox</span> <span class="k">as</span> <span class="n">_QMessageBox</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QWidget</span> <span class="k">as</span> <span class="n">_QWidget</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QTableWidgetItem</span> <span class="k">as</span> <span class="n">_QTableWidgetItem</span>

<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">savgol_filter</span> <span class="k">as</span> <span class="n">_sg</span>


<span class="kn">from</span> <span class="nn">crikit.cri.error_correction</span> <span class="k">import</span> <span class="p">(</span><span class="n">PhaseErrCorrectALS</span> <span class="k">as</span> <span class="n">_PhaseErrCorrectALS</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">crikit.cri.error_correction</span> <span class="k">import</span> <span class="n">ScaleErrCorrectSG</span> <span class="k">as</span> <span class="n">_ScaleErrCorrectSG</span>
<span class="kn">from</span> <span class="nn">crikit.cri.kk</span> <span class="k">import</span> <span class="n">KramersKronig</span>
<span class="kn">from</span> <span class="nn">crikit.cri.merge_nrbs</span> <span class="k">import</span> <span class="n">MergeNRBs</span> <span class="k">as</span> <span class="n">_MergeNRBs</span>

<span class="kn">from</span> <span class="nn">crikit.data.frequency</span> <span class="k">import</span> <span class="p">(</span><span class="n">calib_pix_wn</span> <span class="k">as</span> <span class="n">_calib_pix_wn</span><span class="p">,</span>
                                   <span class="n">calib_pix_wl</span> <span class="k">as</span> <span class="n">_calib_pix_wl</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">crikit.data.hsi</span> <span class="k">import</span> <span class="n">Hsi</span>
<span class="kn">from</span> <span class="nn">crikit.data.spectra</span> <span class="k">import</span> <span class="n">Spectra</span>
<span class="kn">from</span> <span class="nn">crikit.data.spectrum</span> <span class="k">import</span> <span class="n">Spectrum</span>

<span class="kn">from</span> <span class="nn">crikit.datasets.model</span> <span class="k">import</span> <span class="n">Model</span> <span class="k">as</span> <span class="n">_Model</span>

<span class="kn">from</span> <span class="nn">crikit.io.macros</span> <span class="k">import</span> <span class="n">import_csv_nist_special1</span> <span class="k">as</span> <span class="n">io_nist_dlm</span>
<span class="kn">from</span> <span class="nn">crikit.io.macros</span> <span class="k">import</span> <span class="n">import_hdf_nist_special</span> <span class="k">as</span> <span class="n">io_nist</span>
<span class="kn">from</span> <span class="nn">crikit.io.macros</span> <span class="k">import</span> <span class="n">import_hdf_nist_special_ooc</span> <span class="k">as</span> <span class="n">io_nist_ooc</span>

<span class="c1"># from crikit.io.meta_configs import special_nist_bcars2 as _snb2</span>
<span class="c1"># from crikit.io.meta_process import meta_process as _meta_process</span>

<span class="kn">import</span> <span class="nn">crikit.measurement.peakamps</span> <span class="k">as</span> <span class="nn">_peakamps</span>

<span class="kn">from</span> <span class="nn">crikit.preprocess.crop</span> <span class="k">import</span> <span class="n">ZeroColumn</span> <span class="k">as</span> <span class="n">_ZeroColumn</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.crop</span> <span class="k">import</span> <span class="n">ZeroRow</span> <span class="k">as</span> <span class="n">_ZeroRow</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.denoise</span> <span class="k">import</span> <span class="n">SVDDecompose</span><span class="p">,</span> <span class="n">SVDRecompose</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.standardize</span> <span class="k">import</span> <span class="n">Anscombe</span> <span class="k">as</span> <span class="n">_Anscombe</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.standardize</span> <span class="k">import</span> <span class="n">AnscombeInverse</span> <span class="k">as</span> <span class="n">_AnscombeInverse</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.subtract_baseline</span> <span class="k">import</span> \
    <span class="n">SubtractBaselineALS</span> <span class="k">as</span> <span class="n">_SubtractBaselineALS</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.subtract_dark</span> <span class="k">import</span> <span class="n">SubtractDark</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.subtract_mean</span> <span class="k">import</span> <span class="n">SubtractMeanOverRange</span>

<span class="kn">from</span> <span class="nn">crikit.ui.dialog_kkOptions</span> <span class="k">import</span> <span class="n">DialogKKOptions</span>
<span class="kn">from</span> <span class="nn">crikit.ui.dialog_model</span> <span class="k">import</span> <span class="n">DialogModel</span>
<span class="kn">from</span> <span class="nn">crikit.ui.dialog_ploteffect</span> <span class="k">import</span> \
    <span class="n">DialogPlotEffect</span> <span class="k">as</span> <span class="n">_DialogPlotEffect</span>
<span class="kn">from</span> <span class="nn">crikit.ui.dialog_save</span> <span class="k">import</span> <span class="n">DialogSave</span>
<span class="kn">from</span> <span class="nn">crikit.ui.dialog_varstabAnscombeOptions</span> <span class="k">import</span> <span class="n">DialogAnscombeOptions</span>
<span class="kn">from</span> <span class="nn">crikit.ui.dialog_AnscombeParams</span> <span class="k">import</span> <span class="n">DialogCalcAnscombeParams</span>
<span class="kn">from</span> <span class="nn">crikit.ui.qt_CRIkit</span> <span class="k">import</span> <span class="n">Ui_MainWindow</span>
<span class="kn">from</span> <span class="nn">crikit.ui.main_Mosaic</span> <span class="k">import</span> <span class="n">MainWindowMosaic</span>

<span class="kn">from</span> <span class="nn">crikit.ui.utils.roi</span> <span class="k">import</span> <span class="n">roimask</span> <span class="k">as</span> <span class="n">_roimask</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_Calibrate</span> <span class="k">import</span> <span class="n">widgetCalibrate</span> <span class="k">as</span> <span class="n">_widgetCalibrate</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_DeTrending</span> <span class="k">import</span> <span class="n">widgetALS</span> <span class="k">as</span> <span class="n">_widgetALS</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_DeTrending</span> <span class="k">import</span> <span class="n">widgetArPLS</span> <span class="k">as</span> <span class="n">_widgetArPLS</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_DeTrending</span> <span class="k">import</span> <span class="n">widgetDeTrending</span> <span class="k">as</span> <span class="n">_widgetDeTrending</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_images</span> <span class="k">import</span> <span class="p">(</span><span class="n">widgetBWImg</span><span class="p">,</span> <span class="n">widgetCompositeColor</span><span class="p">,</span> <span class="n">widgetSglColor</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">crikit.ui.widget_mergeNRBs</span> <span class="k">import</span> <span class="n">widgetMergeNRBs</span> <span class="k">as</span> <span class="n">_widgetMergeNRBs</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_SG</span> <span class="k">import</span> <span class="n">widgetSG</span> <span class="k">as</span> <span class="n">_widgetSG</span>

<span class="kn">from</span> <span class="nn">crikit.utils.breadcrumb</span> <span class="k">import</span> <span class="n">BCPre</span> <span class="k">as</span> <span class="n">_BCPre</span>
<span class="kn">from</span> <span class="nn">crikit.utils.general</span> <span class="k">import</span> <span class="n">find_nearest</span><span class="p">,</span> <span class="n">mean_nd_to_1d</span><span class="p">,</span> <span class="n">std_nd_to_1d</span>

<span class="kn">from</span> <span class="nn">sciplot.sciplotUI</span> <span class="k">import</span> <span class="n">SciPlotUI</span> <span class="k">as</span> <span class="n">_SciPlotUI</span>

<span class="kn">import</span> <span class="nn">lazy5</span>
<span class="kn">from</span> <span class="nn">lazy5.ui.QtHdfLoad</span> <span class="k">import</span> <span class="n">HdfLoad</span>

<span class="n">force_not_sw</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">crikit2_sw</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">__sw_installed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SW package not installed, using standard&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">crikit.ui.dialog_SVD</span> <span class="k">import</span> <span class="n">DialogSVD</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">__sw_installed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">force_not_sw</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SW package installed, but forced off -- using standard&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">crikit.ui.dialog_SVD</span> <span class="k">import</span> <span class="n">DialogSVD</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SW package installed, let</span><span class="se">\&#39;</span><span class="s1">s rock!&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">crikit2_sw.ui.dialog_SVD</span> <span class="k">import</span> <span class="n">DialogSVD</span>


<span class="n">_mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Qt5Agg&#39;</span><span class="p">)</span>
<span class="n">_mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sans-serif&#39;</span>
<span class="n">_mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">jupyter_flag</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">crikit.ui.widget_Jupyter</span> <span class="k">import</span> <span class="n">QJupyterWidget</span>
    <span class="n">jupyter_flag</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No appropriate Jupyter/IPython installation found. Console will not be available&#39;</span><span class="p">)</span>
    <span class="n">jupyter_flag</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">str_doc</span> <span class="o">=</span> <span class="s1">&#39;../docs/build/html/index.html&#39;</span>
<span class="n">help_index</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">str_doc</span><span class="p">))</span>

<span class="k">if</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">help_index</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">help_index</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="CRIkitUI_process"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process">[docs]</a><span class="k">class</span> <span class="nc">CRIkitUI_process</span><span class="p">(</span><span class="n">_QMainWindow</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CRIkitUI_process : CRIkitUI for image (pre-)processing</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    [1] C H Camp Jr, Y J Lee, and M T Cicerone, &quot;Quantitative, Comparable Coherent \</span>
<span class="sd">    Anti-Stokes Raman Scattering (CARS) Spectroscopy: Correcting Errors in Phase \</span>
<span class="sd">    Retrieval,&quot; Journal of Raman Spectroscopy (2016). arXiv:1507.06543.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NUMCOLORS</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Number of single-color windows to auto-generate</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># Generic load/init designer-based GUI</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">CRIkitUI_process</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="c1">### EDIT ###</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span> <span class="o">=</span> <span class="n">_BCPre</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fid</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hsi&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="n">Hsi</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>

        <span class="c1"># Overlays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_overlays</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># ROI&#39;s to plot instead of random spectra</span>
        <span class="c1"># Primarily affects dialogPlotEffect activities</span>
        <span class="c1"># Also affected by setting actionUseSet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Piecewise NRB&#39;s (not always used)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>

        <span class="c1"># Internal Parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span> <span class="o">=</span> <span class="n">_SciPlotUI</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpl_v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">_mpl_v1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_MainWindow</span><span class="p">()</span> <span class="c1">### EDIT ###</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>     <span class="c1">### EDIT ###</span>

        <span class="c1"># Match UI Show overlays to attribute of this class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowOverlays</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_overlays</span><span class="p">)</span>


        <span class="c1"># Initialize Intensity image (single frequency B&amp;W)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span> <span class="o">=</span> <span class="n">widgetBWImg</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">figfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkBoxFixed</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">maxer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">minner</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sweeperVL</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tight_layout failed (CrikitUI: 1&#39;</span><span class="p">)</span>

        <span class="c1"># ID used for matplotlib to connect to a figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Initialize Single-Color RGB widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NUMCOLORS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widgetSglColor</span><span class="p">(</span><span class="n">figfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>

        <span class="c1"># Split from previous for-loop for compactness of code</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">rgb_img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">):</span>
            <span class="n">color_str</span> <span class="o">=</span> <span class="n">rgb_img</span><span class="o">.</span><span class="n">colormode</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxFGColor</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

            <span class="c1"># Note: colors.to_rgb exists in MPL 2*, but is under colorConverter</span>
            <span class="c1"># in MPL &lt; 2.</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">colormap</span> <span class="o">=</span> <span class="n">_mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">colorConverter</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">_mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">color_str</span><span class="p">])</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">colormode</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxFGColor</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

            <span class="n">rgb_img</span><span class="o">.</span><span class="n">popimage</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">rgb_img</span><span class="p">,</span> <span class="s1">&#39;Color &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>


            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonBasicMath</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonScripting</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq1</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setOpFreq1</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq2</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setOpFreq2</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq3</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setOpFreq3</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxOperations</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opChange</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq1</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setCondFreq1</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq2</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setCondFreq2</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq3</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setCondFreq3</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondOps</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condOpChange</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondInEquality</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condInEqualityChange</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxInEquality</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxInEqualityChange</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonBasicMath</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doMath</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxGain</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span> <span class="o">=</span> <span class="n">widgetCompositeColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">,</span>
                                                  <span class="n">figfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span> <span class="o">=</span> <span class="n">widgetCompositeColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">,</span>
                                                   <span class="n">figfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="p">,</span> <span class="s1">&#39;Composite Image&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sweeperVL_2</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkCompositeUpdate</span><span class="p">)</span>


        <span class="c1"># SIGNALS &amp; SLOTS</span>

        <span class="c1"># Load Data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpenHDFNIST</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileOpenHDFNIST</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpenHDFNISTOOC</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileOpenHDFNISTOOC</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadNRB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDark</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadDark</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpenDLMNIST</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileOpenDLMNIST</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRBDLM</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadNRBDLM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDarkDLM</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadDarkDLM</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrbFromROI</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAppend_NRB_from_ROI</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrbFromROI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Left_Side</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadNRB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI_Left_Side</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrbFromROI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Right_Side</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadNRB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI_Right_Side</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrbFromROI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mergeNRBs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCreateMosaic</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mosaicTool</span><span class="p">)</span>

        <span class="c1"># Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSettings</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>

        <span class="c1"># Undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doUndo</span><span class="p">)</span>

        <span class="c1"># Close event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">closeEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closeEvent</span>

        <span class="c1"># Subtract DARK-Related</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subDark</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionResidualSubtract</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subResidual</span><span class="p">)</span>


        <span class="c1"># ZERO first column or row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstColumn</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeroFirstColumn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstRow</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeroFirstRow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastColumn</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeroLastColumn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastRow</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeroLastRow</span><span class="p">)</span>

        <span class="c1"># Set frequency WINDOW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionFreqWindow</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqWindow</span><span class="p">)</span>

        <span class="c1"># Calibrate Wavenumber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalibrate</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionResetCalibration</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrationReset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionEstCalibration</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specialEstCalibration1</span><span class="p">)</span>

        <span class="c1"># NIST Special</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeMosaicRGBImages</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specialDemosaicRGB</span><span class="p">)</span>

        <span class="c1"># Perform KK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doKK</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Variance Stabilize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAnscombe</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anscombe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionInverseAnscombe</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inverseAnscombe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalcAnscParams</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calcAnscombeParams</span><span class="p">)</span>

        <span class="c1"># DeNoise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoise</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deNoise</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deNoiseNRB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseDark</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deNoiseDark</span><span class="p">)</span>

        <span class="c1"># Error Correction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errorCorrectPhase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errorCorrectScale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAmpErrorCorrection</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errorCorrectAmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSubtractROI</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtractROIStart</span><span class="p">)</span>

        <span class="c1"># Preview ROIs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSetPreviewROI</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_preview_rois</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeletePreviewROI</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_preview_rois</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowPreviewROI</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowPreviewROILegend</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">)</span>

        <span class="c1"># SAVE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSave</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">)</span>

        <span class="c1"># Plotting spectra-related</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPointSpectrum</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointSpectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionROISpectrum</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roiSpectrum</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotDarkSpectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotNRBSpectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLeftSideNRBSpect</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotLeftNRBSpectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionRightSideNRBSpect</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotRightNRBSpectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowPlotter</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotter_show</span><span class="p">)</span>

        <span class="c1"># Overlays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">modelLine</span><span class="o">.</span><span class="n">dataDeleted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updateOverlays</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">modelLine</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updateOverlays</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">all_cleared</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deleteOverlays</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowOverlays</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkShowOverlays</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowOverlayLegend</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">)</span>

       <span class="c1"># Frequency-slider related</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">sliderPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sliderPressed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">sliderReleased</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sliderReleased</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

       <span class="c1"># Frequency-slider display boxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineEditFreqChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditPix</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineEditPixChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditPix</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">labelFreqPixel</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUseImagData</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">)</span>

        <span class="c1"># Help</span>
        <span class="k">if</span> <span class="n">help_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionHelpManual</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">_webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;file:///&#39;</span> <span class="o">+</span> <span class="n">help_index</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionHelpManual</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionRamanPhantom</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">makeRamanPhantom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionBCARSPhantom</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">makeBCARSPhantom</span><span class="p">)</span>

        <span class="c1"># Jupyter console</span>

        <span class="k">if</span> <span class="n">jupyter_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">str_banner</span> <span class="o">=</span> <span class="s1">&#39;Welcome to the embedded ipython console</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">jupyterConsole</span> <span class="o">=</span> <span class="n">QJupyterWidget</span><span class="p">(</span><span class="n">customBanner</span><span class="o">=</span><span class="n">str_banner</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error loading embedded IPython Notebook&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabMain</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jupyterConsole</span><span class="p">,</span> <span class="s1">&#39;Jupyter/IPython Console&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">jupyterConsole</span><span class="o">.</span><span class="n">pushVariables</span><span class="p">({</span><span class="s1">&#39;ui&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span>
                                                <span class="s1">&#39;bcpre&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="p">,</span>
                                                <span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="p">,</span>
                                                <span class="s1">&#39;nrb&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="p">,</span>
                                                <span class="s1">&#39;crikit_data&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabMain</span><span class="o">.</span><span class="n">currentChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabMainChange</span><span class="p">)</span>


        <span class="c1"># Temporary toolbar setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">setToolButtonStyle</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolButtonTextUnderIcon</span><span class="p">)</span>

        <span class="c1"># Default toolbar is NIST Workflow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbarSetup</span><span class="p">()</span>

        <span class="c1"># COMMAND LINE INTERPRETATION</span>

        <span class="c1"># file and dset info provided</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lazy5</span><span class="o">.</span><span class="n">inspect</span><span class="o">.</span><span class="n">valid_dsets</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                        <span class="n">dset_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">pth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenHDFNIST</span><span class="p">(</span><span class="n">dialog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Hsi provided</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hsi&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenSuccess</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in input hsi&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">()</span>

        <span class="c1"># x-array provided</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">temp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_x_rep</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x_units&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_x_rep</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x_label&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in input x-array&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># y-array provided</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">temp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_y_rep</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y_units&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_y_rep</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y_label&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in input y-array&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># freq-array provided</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">temp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;f_units&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;f_label&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in input freq-array (f)&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># data provided</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenSuccess</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in input data&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">()</span>

<div class="viewcode-block" id="CRIkitUI_process.mosaicTool"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.mosaicTool">[docs]</a>    <span class="k">def</span> <span class="nf">mosaicTool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">win</span> <span class="o">=</span> <span class="n">MainWindowMosaic</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.updateHistory"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.updateHistory">[docs]</a>    <span class="k">def</span> <span class="nf">updateHistory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableWidgetHistory</span><span class="o">.</span><span class="n">clearContents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableWidgetHistory</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">attr_dict</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">attr_dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableWidgetHistory</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_QTableWidgetItem</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableWidgetHistory</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                               <span class="n">_QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">attr_dict</span><span class="p">[</span><span class="n">q</span><span class="p">])))</span></div>

<div class="viewcode-block" id="CRIkitUI_process.plotter_show"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.plotter_show">[docs]</a>    <span class="k">def</span> <span class="nf">plotter_show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.toolbarSetup"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.toolbarSetup">[docs]</a>    <span class="k">def</span> <span class="nf">toolbarSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup the tool ribbon icons</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolbar_view_actions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolbar_view_configs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;default&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpenHDFNIST</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSave</span><span class="p">,</span><span class="s1">&#39;separator&#39;</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPointSpectrum</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionROISpectrum</span><span class="p">,</span>
                                                     <span class="s1">&#39;separator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="p">,</span> <span class="s1">&#39;separator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDark</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="p">,</span> <span class="s1">&#39;separator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionFreqWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAnscombe</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoise</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionInverseAnscombe</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalibrate</span><span class="p">],</span>
                                        <span class="s1">&#39;NIST BCARS2&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpenHDFNIST</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSave</span><span class="p">,</span><span class="s1">&#39;separator&#39;</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPointSpectrum</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionROISpectrum</span><span class="p">,</span>
                                                         <span class="s1">&#39;separator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="p">,</span> <span class="s1">&#39;separator&#39;</span><span class="p">,</span> 
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDark</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Right_Side</span><span class="p">,</span>
                                                         <span class="s1">&#39;separator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionEstCalibration</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionFreqWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAnscombe</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoise</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionInverseAnscombe</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI_Left_Side</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalibrate</span><span class="p">],</span>
                                        <span class="s1">&#39;NIST BCARS1&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpenDLMNIST</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSave</span><span class="p">,</span><span class="s1">&#39;separator&#39;</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPointSpectrum</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionROISpectrum</span><span class="p">,</span>
                                                         <span class="s1">&#39;separator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="p">,</span> <span class="s1">&#39;separator&#39;</span><span class="p">,</span> 
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDarkDLM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRBDLM</span><span class="p">,</span>
                                                         <span class="s1">&#39;separator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionFreqWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAnscombe</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoise</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionInverseAnscombe</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="p">,</span> 
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalibrate</span><span class="p">],</span>
                                        <span class="s1">&#39;None&#39;</span> <span class="p">:</span> <span class="p">[]}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolbar_view_configs</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuToolbar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbarSetting</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolbar_view_actions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="n">ret</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolbar_view_actions</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.toolbarSetting"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.toolbarSetting">[docs]</a>    <span class="k">def</span> <span class="nf">toolbarSetting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the toolbar ribbon view &quot;&quot;&quot;</span>

        <span class="n">sndr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="n">action_key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">action</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolbar_view_actions</span><span class="p">:</span>
            <span class="n">acn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolbar_view_actions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sndr</span> <span class="o">==</span> <span class="n">acn</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">action_key</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">acn</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acn</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">to_add</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolbar_view_configs</span><span class="p">[</span><span class="n">action_key</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">to_add</span> <span class="o">==</span> <span class="s1">&#39;separator&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">to_add</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="CRIkitUI_process.save"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">dset_name_suffix</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">DialogSave</span><span class="o">.</span><span class="n">dialogSave</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="n">current_filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                    <span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                    <span class="n">current_dataset_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c1"># Save canceled</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_filename</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_dataset_name</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">save_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_dataset_name</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_dataset_name_no_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_dataset_name</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">attr_dict</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Meta data (hsi.meta) is not a dictionary&#39;</span><span class="p">)</span>
                <span class="n">attr_dict</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">attr_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">attr_dict</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ret_save</span> <span class="o">=</span> <span class="n">lazy5</span><span class="o">.</span><span class="n">create</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_dataset_name</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">pth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
                                            <span class="n">attr_dict</span><span class="o">=</span> <span class="n">attr_dict</span><span class="p">,</span> <span class="n">sort_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                            <span class="n">chunks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">_traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ret_save</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Save succeeded with no errors.&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> -&gt; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_filename</span><span class="p">))</span></div>

<div class="viewcode-block" id="CRIkitUI_process.tabMainChange"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.tabMainChange">[docs]</a>    <span class="k">def</span> <span class="nf">tabMainChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabMain</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># Jupyter console</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jupyterConsole</span><span class="o">.</span><span class="n">_control</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.closeEvent"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Closing&#39;</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">_QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">closeAllWindows</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">pop_to_last</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">del_flag</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="s1">&#39;.pickle&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in deleting old pickle files&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">del_flag</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">del_flag</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Did not delete pickle file cut list... Something went wrong&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fid</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Closing HDF File&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Something failed in closing the file&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successfully closed HDF File&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.fileOpenHDFNIST"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.fileOpenHDFNIST">[docs]</a>    <span class="k">def</span> <span class="nf">fileOpenHDFNIST</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">dialog</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open and load HDF5 File</span>

<span class="sd">        dialog : bool</span>
<span class="sd">            Present a gui for file and dataset selection</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get data and load into CRI_HSI class</span>
        <span class="c1"># This will need to change to accomodate multiple-file selection</span>

        <span class="k">if</span> <span class="n">dialog</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">to_open</span> <span class="o">=</span> <span class="n">HdfLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Hyperspectral Image&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">to_open</span> <span class="o">=</span> <span class="n">HdfLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Hyperspectral Image&#39;</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;to_open: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_open</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">to_open</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">_traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not open file. Corrupt or not appropriate file format.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">()</span>
                    <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Was successful: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">success</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HSI shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenSuccess</span><span class="p">(</span><span class="n">success</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">()</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenSuccess</span><span class="p">(</span><span class="n">success</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.fileOpenHDFNISTOOC"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.fileOpenHDFNISTOOC">[docs]</a>    <span class="k">def</span> <span class="nf">fileOpenHDFNISTOOC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open and load HDF5 File OUT-OF-CORE</span>

<span class="sd">        dialog : bool</span>
<span class="sd">            Present a gui for file and dataset selection</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get data and load into CRI_HSI class</span>
        <span class="c1"># This will need to change to accomodate multiple-file selection</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">to_open</span> <span class="o">=</span> <span class="n">HdfLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Hyperspectral Image&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_open</span> <span class="o">=</span> <span class="n">HdfLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Hyperspectral Image&#39;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;to_open: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_open</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">to_open</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not open file. Corrupt or not appropriate file format.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">()</span>
                <span class="n">success_fid</span> <span class="o">=</span> <span class="n">io_nist_ooc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">success_fid</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fid</span> <span class="o">=</span> <span class="n">success_fid</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HSI shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenSuccess</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.fileOpenDLMNIST"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.fileOpenDLMNIST">[docs]</a>    <span class="k">def</span> <span class="nf">fileOpenDLMNIST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open and load DLM File</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get data and load into CRI_HSI class</span>
        <span class="c1"># This will need to change to accomodate multiple-file selection</span>
        <span class="n">filename_header</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">_QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open Header File&#39;</span><span class="p">,</span>
                                                         <span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="s1">&#39;All Files (*.*)&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">filename_header</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename_header</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
            <span class="n">filename_data</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">_QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open Data File&#39;</span><span class="p">,</span>
                                                           <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                                           <span class="s1">&#39;All Files (*.*)&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">filename_data</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename_data</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename_data</span><span class="p">))[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">::]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span> <span class="o">=</span> <span class="n">filename_header</span>

                <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist_dlm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenSuccess</span><span class="p">(</span><span class="n">success</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.fileOpenSuccess"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.fileOpenSuccess">[docs]</a>    <span class="k">def</span> <span class="nf">fileOpenSuccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">success</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executed after a file is loaded. Checks success and appropriately</span>
<span class="sd">        activates or deactivates action (buttons)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="c1"># * If HSI is integer dtype, convert to float</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Converting HSI from int to float&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
            <span class="c1"># FILE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSave</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># EDIT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstColumn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstRow</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastColumn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastRow</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionFreqWindow</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalibrate</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionResetCalibration</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># VIEW</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPointSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionROISpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSetPreviewROI</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeletePreviewROI</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># IMPORT/LOAD</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDark</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDarkDLM</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRBDLM</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># self.ui.actionAppend_NRB_from_ROI.setEnabled(True)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Left_Side</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Right_Side</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI_Left_Side</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI_Right_Side</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># PREPROCESS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionResidualSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAnscombe</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionInverseAnscombe</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoise</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAmpErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSubtractROI</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuVariance_Stabilize</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># NIST SPECIAL</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionEstCalibration</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeMosaicRGBImages</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">is_complex</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_complex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDark</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstColumn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstRow</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastColumn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastRow</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Backup for Undo</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">PREFIX</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;Continue&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;Raw&#39;</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">_traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>


        <span class="c1"># Set frequency slider and associated displays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setSliderPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">sliderPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditPix</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">sliderPosition</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="c1"># Set BW Class Data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">initData</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUseImagData</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">pos</span><span class="p">])</span>
                <span class="n">val_extrema</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">pos</span><span class="p">])</span>
                <span class="n">val_extrema</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">pos</span><span class="p">]</span>
            <span class="n">val_extrema</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>

        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
            <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

        <span class="c1"># print(&#39;Xlabel: {}&#39;.format(xlabel))</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
            <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
        <span class="c1"># xlabel = r&#39;{} ({})&#39;.format(self.hsi.x_rep.label.strip(), self.hsi.x_rep.units.strip())</span>
        <span class="c1"># ylabel = r&#39;{} ({})&#39;.format(self.hsi.y_rep.label.strip(), self.hsi.y_rep.units.strip())</span>

        <span class="c1"># print(&#39;Ylabel: {}&#39;.format(ylabel))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
        <span class="c1"># Set min/max, fixed, compress, etc buttons to defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkBoxFixed</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># self.img_BW.ui.checkBoxCompress.setChecked(False)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxAboveMax</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkBoxRemOutliers</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createImgBW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="c1"># RGB images</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span>

        <span class="c1"># Re-initialize RGB images</span>

        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">rgb_img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">):</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">initData</span><span class="p">()</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>

            <span class="n">color_str</span> <span class="o">=</span> <span class="n">rgb_img</span><span class="o">.</span><span class="n">colormode</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxFGColor</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">colormap</span> <span class="o">=</span> <span class="n">_mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">colorConverter</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">_mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">cnames</span><span class="p">[</span><span class="n">color_str</span><span class="p">])</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">colormode</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxFGColor</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

            <span class="c1"># Cute way of setting the colormap to last setting and replotting</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>

            <span class="c1"># Enable Math</span>
            <span class="c1"># rgb_img.math.ui.pushButtonDoMath.setEnabled(True)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonBasicMath</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Enable mean spectrum from RGB images</span>
            <span class="c1"># Note: if load new file after one has already loaded, need to disconnect</span>
            <span class="c1"># signal then reconnect (or could have ignored, but this is easier)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rgb_img</span><span class="o">.</span><span class="n">popimage</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonSpectrum</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">rgb_img</span><span class="o">.</span><span class="n">popimage</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonSpectrum</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrumColorImg</span><span class="p">)</span>

            <span class="n">rgb_img</span><span class="o">.</span><span class="n">popimage</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">rgb_img</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>

        <span class="c1"># Set X- and Y- scales, labels, etc for composite color images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.loadDark"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.loadDark">[docs]</a>    <span class="k">def</span> <span class="nf">loadDark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open HDF file and load dark spectrum(a)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">to_open</span> <span class="o">=</span> <span class="n">HdfLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Dark&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_open</span> <span class="o">=</span> <span class="n">HdfLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Dark&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;To_open: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_open</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pth</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datasets</span> <span class="o">=</span> <span class="n">to_open</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="c1"># If Dark is integer dtype, convert to float</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Converting Dark from int to float&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseDark</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalcAnscParams</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dark was the wrong shape&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseDark</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="CRIkitUI_process.loadDarkDLM"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.loadDarkDLM">[docs]</a>    <span class="k">def</span> <span class="nf">loadDarkDLM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open DLM file and load dark spectrum(a)</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">filename</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">_QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open Dark File&#39;</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                                  <span class="s1">&#39;All Files (*.*)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">))[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">::]</span>


            <span class="c1"># Spectra first</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist_dlm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span> <span class="c1"># Maybe Spectrum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
                <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist_dlm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="c1"># If Dark is integer dtype, convert to float</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Converting Dark from int to float&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalcAnscParams</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dark was the wrong shape&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="CRIkitUI_process.loadNRB"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.loadNRB">[docs]</a>    <span class="k">def</span> <span class="nf">loadNRB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open HDF file and load NRB spectrum(a)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="p">:</span>
            <span class="n">nrb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Left_Side</span><span class="p">:</span>
            <span class="n">nrb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Right_Side</span><span class="p">:</span>
            <span class="n">nrb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span>


        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">to_open</span> <span class="o">=</span> <span class="n">HdfLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;NRB&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_open</span> <span class="o">=</span> <span class="n">HdfLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;NRB&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pth</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datasets</span> <span class="o">=</span> <span class="n">to_open</span>

            <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">nrb</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="c1"># If NRB is integer dtype, convert to float</span>
                <span class="k">if</span> <span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Converting NRB from int to float&#39;</span><span class="p">)</span>
                    <span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span>

                <span class="k">if</span> <span class="n">nrb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuCoherent_Raman_Imaging</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalcAnscParams</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Left_Side</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLeftSideNRBSpect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Right_Side</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionRightSideNRBSpect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRB was the wrong shape&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.loadNRBDLM"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.loadNRBDLM">[docs]</a>    <span class="k">def</span> <span class="nf">loadNRBDLM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open DLM file and load NRB spectrum(a)</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">filename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open NRB File&#39;</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                                   <span class="s1">&#39;All Files (*.*)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">))[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">::]</span>


            <span class="c1"># Spectra first</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist_dlm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span> <span class="c1"># Maybe Spectrum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
                <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist_dlm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Success: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">success</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalcAnscParams</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRB was the wrong shape&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.get_preview_spectra"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.get_preview_spectra">[docs]</a>    <span class="k">def</span> <span class="nf">get_preview_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If self.preview_rois is set, output the mean spectra from thos regions &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">pix_vec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span><span class="p">:</span>
            <span class="n">prev_spectra</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">prx</span><span class="p">,</span> <span class="n">pry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span><span class="p">:</span>

                <span class="n">mask</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">_roimask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">prx</span><span class="p">,</span> <span class="n">pry</span><span class="p">)</span>

                <span class="n">mask_hits</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Len(mask) &gt; 0</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">][</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
                    

                    <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">prev_spectra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">prev_spectra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prev_spectra</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.set_preview_rois"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.set_preview_rois">[docs]</a>    <span class="k">def</span> <span class="nf">set_preview_rois</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the preview ROIs. NOTE: this function just sets the signal for the MPL window &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Updated by _roiClick</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span>
                                                   <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiPreviewClick</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.showPreviewRois"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.showPreviewRois">[docs]</a>    <span class="k">def</span> <span class="nf">showPreviewRois</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="p">(</span><span class="n">prx</span><span class="p">,</span> <span class="n">pry</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span><span class="p">):</span>
                <span class="n">temp</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prx</span><span class="p">,</span> <span class="n">pry</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Preview ROI </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">),</span>
                                            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span> <span class="o">%</span> <span class="mi">10</span><span class="p">))</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowPreviewROILegend</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="c1"># lg = self.img_BW.mpl.ax.legend(handles=lines, loc=&#39;lower left&#39;, mode=&#39;expand&#39;, </span>
                <span class="c1">#                                bbox_to_anchor=(0.01, 1.02, 1., 0.2),</span>
                <span class="c1">#                                ncol=2, fontsize=9)</span>
                <span class="n">lg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> 
                                            <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">lg</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tight_layout failed (CrikitUI: 2&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process._roiPreviewClick"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._roiPreviewClick">[docs]</a>    <span class="k">def</span> <span class="nf">_roiPreviewClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture region-of-interest mouse click locations in MPL window.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">getx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">gety</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">,</span>
                                            <span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">markeredgecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                                            <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">getx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">gety</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
                                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                                            <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                            <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">markeredgecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">getx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">gety</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Insure at least 1 vertex</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
                                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                                        <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">markeredgecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">getx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">gety</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span>
            
                <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.delete_preview_rois"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.delete_preview_rois">[docs]</a>    <span class="k">def</span> <span class="nf">delete_preview_rois</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.mergeNRBs"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.mergeNRBs">[docs]</a>    <span class="k">def</span> <span class="nf">mergeNRBs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interactive merge of the left- and right-side NRB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUsePreviewROI</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()):</span>
                <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_preview_spectra</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">preview_spectra</span><span class="p">):</span>
                <span class="n">preview_spectra</span> <span class="o">=</span> <span class="n">preview_spectra</span><span class="o">.</span><span class="n">imag</span>

            <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetMergeNRBs</span><span class="p">(</span><span class="n">wn_vec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                      <span class="n">nrb_left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">],</span>
                                      <span class="n">nrb_right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">])</span>
            <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">preview_spectra</span><span class="p">,</span>
                                                               <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                               <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRB merge pixel: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pix_switchpt&#39;</span><span class="p">]))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRB merge WN: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;wn_switchpt&#39;</span><span class="p">]))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRB merge scale left side: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scale_left&#39;</span><span class="p">]))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nrb shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

                <span class="n">inst_nrb_merge</span> <span class="o">=</span> <span class="n">_MergeNRBs</span><span class="p">(</span><span class="n">nrb_left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">],</span>
                                            <span class="n">nrb_right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">],</span>
                                            <span class="n">pix</span><span class="o">=</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pix_switchpt&#39;</span><span class="p">],</span>
                                            <span class="n">left_side_scale</span><span class="o">=</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scale_left&#39;</span><span class="p">])</span>
                <span class="n">nrb_merge</span> <span class="o">=</span> <span class="n">inst_nrb_merge</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>

                <span class="c1"># Need 2D because of class Spectra NOT Spectrum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">]</span> <span class="o">=</span> <span class="n">nrb_merge</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuCoherent_Raman_Imaging</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalcAnscParams</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">wn</span><span class="p">,</span> <span class="n">pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pix_switchpt&#39;</span><span class="p">]])</span>

                <span class="c1"># Backup for Undo</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;MergeNRBs&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;pix_switchpt&#39;</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span>
                                     <span class="s1">&#39;wn_switchpt&#39;</span><span class="p">,</span>
                                     <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;wn_switchpt&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;scale_left&#39;</span><span class="p">,</span>
                                     <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scale_left&#39;</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.settings"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.settings">[docs]</a>    <span class="k">def</span> <span class="nf">settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Go to settings tab</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabMain</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabSettings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabMain</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.calibrate"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.calibrate">[docs]</a>    <span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calibrate spectra</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUsePreviewROI</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()):</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_preview_spectra</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">preview_spectra</span><span class="p">):</span>
                <span class="n">preview_spectra</span> <span class="o">=</span> <span class="n">preview_spectra</span><span class="o">.</span><span class="n">imag</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetCalibrate</span><span class="p">(</span><span class="n">calib_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span><span class="p">)</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="n">preview_spectra</span><span class="p">,</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#print(&#39;New Calibration Dictionary: {}&#39;.format(winPlotEffect.new_calib_dict))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;new_calib_dict&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>


<div class="viewcode-block" id="CRIkitUI_process.calibrationReset"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.calibrationReset">[docs]</a>    <span class="k">def</span> <span class="nf">calibrationReset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set self.hsi.freqcalib back to self.hsi.freqcaliborig</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.specialEstCalibration1"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.specialEstCalibration1">[docs]</a>    <span class="k">def</span> <span class="nf">specialEstCalibration1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For NIST BCARS 2, maximum raw spectrum occurs at approximately</span>
<span class="sd">        745.8 nm (18/07/11)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Estimate calibration for NIST BCARS2?&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm estimation of calibration&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s1">&#39;This should only be applied to RAW BCARS2 data from NIST.&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
            <span class="n">nm_diff</span> <span class="o">=</span> <span class="mf">745.8</span> <span class="o">-</span> <span class="n">_calib_pix_wl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span><span class="p">[</span><span class="s1">&#39;a_vec&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span><span class="p">[</span><span class="s1">&#39;a_vec&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">nm_diff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.plotDarkSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.plotDarkSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">plotDarkSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot dark spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meaner</span> <span class="o">=</span> <span class="n">mean_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">meaner</span><span class="p">,</span> 
                              <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Dark Spectrum (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">n_pix</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">n_pix</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">stder</span> <span class="o">=</span> <span class="n">std_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">list_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
                <span class="n">std_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Dark Spectrum $\pm$1 Std. Dev. (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">n_pix</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">meaner</span> <span class="o">-</span> <span class="n">stder</span><span class="p">,</span>
                                          <span class="n">meaner</span> <span class="o">+</span> <span class="n">stder</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="n">std_label</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.plotNRBSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.plotNRBSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">plotNRBSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot NRB spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meaner</span> <span class="o">=</span> <span class="n">mean_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">meaner</span><span class="p">,</span> 
                              <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean NRB Spectrum (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">n_pix</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">n_pix</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">stder</span> <span class="o">=</span> <span class="n">std_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">list_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
                <span class="n">std_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;NRB Spectrum $\pm$1 Std. Dev. (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">n_pix</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">meaner</span> <span class="o">-</span> <span class="n">stder</span><span class="p">,</span>
                                          <span class="n">meaner</span> <span class="o">+</span> <span class="n">stder</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="n">std_label</span><span class="p">)</span>

            <span class="c1"># self.plotter.plot(self.hsi.f_full, mean_nd_to_1d(self.nrb.data),</span>
            <span class="c1">#                   label=&#39;Mean NRB Spectrum&#39;)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.plotLeftNRBSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.plotLeftNRBSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">plotLeftNRBSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot Left-Side NRB spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meaner</span> <span class="o">=</span> <span class="n">mean_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">meaner</span><span class="p">,</span> 
                              <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Left-Side NRB Spectrum (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">n_pix</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">n_pix</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">stder</span> <span class="o">=</span> <span class="n">std_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">list_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
                <span class="n">std_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Left-Side NRB Spectrum $\pm$1 Std. Dev. (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">n_pix</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">meaner</span> <span class="o">-</span> <span class="n">stder</span><span class="p">,</span>
                                          <span class="n">meaner</span> <span class="o">+</span> <span class="n">stder</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="n">std_label</span><span class="p">)</span>

            <span class="c1"># self.plotter.plot(self.hsi.f_full, mean_nd_to_1d(self.nrb_left.data),</span>
            <span class="c1">#                   label=&#39;Mean Left-Side NRB Spectrum&#39;)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.plotRightNRBSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.plotRightNRBSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">plotRightNRBSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot NRB spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meaner</span> <span class="o">=</span> <span class="n">mean_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">meaner</span><span class="p">,</span>
                              <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Right-Side NRB Spectrum (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">n_pix</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">n_pix</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">stder</span> <span class="o">=</span> <span class="n">std_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">list_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
                <span class="n">std_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Right-Side NRB Spectrum $\pm$1 Std. Dev. (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">n_pix</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">meaner</span> <span class="o">-</span> <span class="n">stder</span><span class="p">,</span>
                                          <span class="n">meaner</span> <span class="o">+</span> <span class="n">stder</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="n">std_label</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.pointSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.pointSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">pointSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get spectrum of selected point.</span>

<span class="sd">        Note: This function just sets up the signal-slot connection for the \</span>
<span class="sd">        MPL window. It executes all the way through</span>

<span class="sd">        Action:</span>
<span class="sd">            Left mouse-click : Select vertex point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span>
                                                   <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pointClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pointSpectrumPlot</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span></div>

<div class="viewcode-block" id="CRIkitUI_process.subtractROIStart"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.subtractROIStart">[docs]</a>    <span class="k">def</span> <span class="nf">subtractROIStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire an average spectrum from a user-selected ROI and subtract.</span>

<span class="sd">        Note: This function just sets up the signal-slot connection for the \</span>
<span class="sd">        MPL window. It executes all the way through</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Updated by _roiClick</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span> <span class="o">=</span> <span class="p">[]</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span>
                                                   <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiSubtract</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span></div>

<div class="viewcode-block" id="CRIkitUI_process._roiSubtract"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._roiSubtract">[docs]</a>    <span class="k">def</span> <span class="nf">_roiSubtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire an average spectrum from a user-selected ROI and subtract.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span> <span class="o">=</span> <span class="n">locs</span>

        <span class="n">x_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">mask</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">_roimask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                              <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)</span>


        <span class="n">mask_hits</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Len(mask) &gt; 0</span>

            <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span>
            <span class="n">spectrum</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="o">-=</span> <span class="n">spectrum</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>


            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;SubtractROI&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectrum&#39;</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>


            <span class="k">del</span> <span class="n">spectrum</span>

        <span class="k">del</span> <span class="n">x_pix</span>
        <span class="k">del</span> <span class="n">y_pix</span></div>

<div class="viewcode-block" id="CRIkitUI_process.nrbFromROI"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.nrbFromROI">[docs]</a>    <span class="k">def</span> <span class="nf">nrbFromROI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire an average spectrum from a user-selected ROI and apply to the \</span>
<span class="sd">        NRB-- either as the new NRB or averaged with the existing (sender- \</span>
<span class="sd">        dependent)</span>

<span class="sd">        Note: This function just sets up the signal-slot connection for the \</span>
<span class="sd">        MPL window. It executes all the way through</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># I found that the objectName is a better way than a reference to the</span>
        <span class="c1"># actual action (e.g., self.ui.action_*) as the reference may change</span>
        <span class="c1"># depending on the call location or how this method is called</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionAppend_NRB_from_ROI&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI_Left_Side&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI_Right_Side&#39;</span><span class="p">)):</span>
            <span class="c1"># Updated by _roiClick</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Need to send sender as the text name as the actual object</span>
            <span class="c1"># will change</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span>
                                                       <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiNRB</span><span class="p">,</span> <span class="n">sender</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unknown action send to nrbFromROI&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process._roiNRB"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._roiNRB">[docs]</a>    <span class="k">def</span> <span class="nf">_roiNRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire an average spectrum from a user-selected ROI and subtract.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Sender was sent as a text reference to the actual sender</span>
        <span class="c1"># the pass of sender put it in a tuple; thus the [0]</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="n">sender</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span> <span class="o">=</span> <span class="n">locs</span>

        <span class="n">x_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">mask</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">_roimask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                              <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)</span>


        <span class="n">mask_hits</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Len(mask) &gt; 0</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">_h5py</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mask</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span> 
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUseImagData</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">imag</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">real</span>

            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span>

            <span class="n">spectrum</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuCoherent_Raman_Imaging</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalcAnscParams</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionAppend_NRB_from_ROI&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">spectrum</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI_Left_Side&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLeftSideNRBSpect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI_Right_Side&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionRightSideNRBSpect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unknown action sent to _roiNRB&#39;</span><span class="p">)</span>

            <span class="k">del</span> <span class="n">spectrum</span>

        <span class="k">del</span> <span class="n">x_pix</span>
        <span class="k">del</span> <span class="n">y_pix</span></div>

<div class="viewcode-block" id="CRIkitUI_process.roiSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.roiSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">roiSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot spectrum over selected region-of-interest (ROI).</span>

<span class="sd">        Note: This function just sets up the signal-slot connection for the \</span>
<span class="sd">        MPL window. It executes all the way through</span>

<span class="sd">        Action:</span>
<span class="sd">            Left mouse-click : Select vertex point</span>
<span class="sd">            Right mouse-click : Close polygon</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Updated by _roiClick</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span> <span class="o">=</span> <span class="p">[]</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span>
                                                   <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiSpectrumPlot</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span></div>

<div class="viewcode-block" id="CRIkitUI_process._pointClick"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._pointClick">[docs]</a>    <span class="k">def</span> <span class="nf">_pointClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">pass_fcn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture single mouse click location in MPL window.</span>

<span class="sd">        After this function completes, it sends the data (x_pt, y_pt) on to \</span>
<span class="sd">        the pass_fcn function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
                    <span class="c1">#self.tempverts += [[event.xdata, event.ydata]]</span>
                <span class="n">x_loc</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
                <span class="n">y_loc</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>

                <span class="c1"># Send on to a function that will use the collected data</span>
                <span class="n">pass_fcn</span><span class="p">((</span><span class="n">x_loc</span><span class="p">,</span> <span class="n">y_loc</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Clicked out-of-bounds</span>
                <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1"># Right-or-middle clicked; thus, cancel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CRIkitUI_process._pointSpectrumPlot"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._pointSpectrumPlot">[docs]</a>    <span class="k">def</span> <span class="nf">_pointSpectrumPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a plot (in plotter) of a point spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x_loc</span><span class="p">,</span> <span class="n">y_loc</span> <span class="o">=</span> <span class="n">locs</span>
        <span class="n">x_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x_loc</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y_loc</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>

        <span class="n">plot_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">n_lines</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Point &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">plot_num</span><span class="p">)</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_loc</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_loc</span><span class="p">,</span> <span class="s1">&#39;x_pix&#39;</span><span class="p">:</span> <span class="n">x_pix</span><span class="p">,</span> <span class="s1">&#39;y_pix&#39;</span><span class="p">:</span> <span class="n">y_pix</span><span class="p">,</span>
                <span class="s1">&#39;overlay&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUseImagData</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">y_pix</span><span class="p">,</span> <span class="n">x_pix</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                              <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">y_pix</span><span class="p">,</span> <span class="n">x_pix</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                              <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateOverlays</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process._roiSpectrumPlot"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._roiSpectrumPlot">[docs]</a>    <span class="k">def</span> <span class="nf">_roiSpectrumPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a plot (in plotter) of the mean spectrum over a region</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span> <span class="o">=</span> <span class="n">locs</span>

        <span class="n">x_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>


        <span class="n">mask</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">_roimask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                              <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)</span>


        <span class="n">mask_hits</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Len(mask) &gt; 0</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">_h5py</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>

                <span class="c1"># * Can&#39;t do fancy boolean indexing with HDF</span>
                <span class="c1"># * Make a square bounding box</span>
                <span class="n">m</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">rmin</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">rmax</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">cmin</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">cmax</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>

                <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">rmin</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span> <span class="n">cmin</span><span class="p">:</span><span class="n">cmax</span><span class="p">,:][</span><span class="n">mask</span><span class="p">[</span><span class="n">rmin</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span> <span class="n">cmin</span><span class="p">:</span><span class="n">cmax</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUseImagData</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">imag</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">real</span>

            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">stddev</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">])</span>

            <span class="n">plot_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">n_lines</span>

            <span class="n">label_plot</span> <span class="o">=</span> <span class="s1">&#39;ROI </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_num</span><span class="p">,</span> <span class="n">mask_hits</span><span class="p">)</span>
            <span class="n">label_std</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\pm$1 Std. Dev. ROI </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_num</span><span class="p">,</span> <span class="n">mask_hits</span><span class="p">)</span>

            <span class="c1"># Plot line</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_loc_list</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_loc_list</span><span class="p">,</span> <span class="s1">&#39;x_pix&#39;</span><span class="p">:</span> <span class="n">x_pix</span><span class="p">,</span>
                    <span class="s1">&#39;y_pix&#39;</span><span class="p">:</span> <span class="n">y_pix</span><span class="p">,</span> <span class="s1">&#39;overlay&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_plot</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>

            <span class="c1"># Check color of line b/c uses color cycler-- for fill_b/w</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">list_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>


            <span class="c1"># Alternative</span>
            <span class="c1">#color = self.plotter.modelLine._model_data[-1][&#39;color&#39;]</span>

            <span class="c1"># Plot +-1 std. dev.</span>
            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">-</span><span class="n">stddev</span><span class="p">,</span>
                                          <span class="n">spectrum</span><span class="o">+</span><span class="n">stddev</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="n">label_std</span><span class="p">,</span>
                                          <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>

            <span class="k">del</span> <span class="n">spectrum</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateOverlays</span><span class="p">()</span>


        <span class="k">del</span> <span class="n">x_pix</span>
        <span class="k">del</span> <span class="n">y_pix</span></div>

<div class="viewcode-block" id="CRIkitUI_process._roiClick"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._roiClick">[docs]</a>    <span class="k">def</span> <span class="nf">_roiClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">pass_fcn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture region-of-interest mouse click locations in MPL window.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>

                <span class="n">getx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
                <span class="n">gety</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">,</span>
                                            <span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">markeredgecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                                            <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">getx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">gety</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
                                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                                            <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                            <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">markeredgecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">getx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">gety</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Insure at least 1 vertex</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="c1"># Pass on roi data</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
                    <span class="n">pass_fcn</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pass_fcn</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">),</span> <span class="n">args</span><span class="p">)</span>

            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>


<div class="viewcode-block" id="CRIkitUI_process.freqWindow"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.freqWindow">[docs]</a>    <span class="k">def</span> <span class="nf">freqWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Limit the frequency window displayed and analyzed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">_QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Frequency Window&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;Range Tuple (cm-1): &#39;</span><span class="p">,</span>
                                         <span class="n">text</span><span class="o">=</span><span class="s1">&#39;(500, 3800)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">text_str_list</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">freqwin</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">text_str_list</span><span class="p">]</span>
            <span class="n">freqwin</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_list_freq</span> <span class="o">=</span> <span class="n">freqwin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>


<div class="viewcode-block" id="CRIkitUI_process.lineEditFreqChanged"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.lineEditFreqChanged">[docs]</a>    <span class="k">def</span> <span class="nf">lineEditFreqChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Frequency manually entered in frequency-slider-display</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">freq_in</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="n">freq_in</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_list_pix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_list_pix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setSliderPosition</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.lineEditPixChanged"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.lineEditPixChanged">[docs]</a>    <span class="k">def</span> <span class="nf">lineEditPixChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Frequency in pixel units manually entered in frequency-slider-display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditPix</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setSliderPosition</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.zeroFirstColumn"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.zeroFirstColumn">[docs]</a>    <span class="k">def</span> <span class="nf">zeroFirstColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zero first non-all-zero column. (Rather than crop)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zc</span> <span class="o">=</span> <span class="n">_ZeroColumn</span><span class="p">(</span><span class="n">first_or_last</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Adjust mask</span>
        <span class="c1"># self.hsi._mask[:, self.zc.zero_col] *= 0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.zeroFirstRow"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.zeroFirstRow">[docs]</a>    <span class="k">def</span> <span class="nf">zeroFirstRow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zero first non-all-zero row. (Rather than crop)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zr</span> <span class="o">=</span> <span class="n">_ZeroRow</span><span class="p">(</span><span class="n">first_or_last</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Adjust mask</span>
        <span class="c1"># self.hsi._mask[self.zr.zero_row, :] *= 0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.zeroLastColumn"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.zeroLastColumn">[docs]</a>    <span class="k">def</span> <span class="nf">zeroLastColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zero first non-all-zero column. (Rather than crop)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zc</span> <span class="o">=</span> <span class="n">_ZeroColumn</span><span class="p">(</span><span class="n">first_or_last</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Adjust mask</span>
        <span class="c1"># self.hsi._mask[:, self.zc.zero_col] *= 0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.zeroLastRow"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.zeroLastRow">[docs]</a>    <span class="k">def</span> <span class="nf">zeroLastRow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zero first non-all-zero row. (Rather than crop)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zr</span> <span class="o">=</span> <span class="n">_ZeroRow</span><span class="p">(</span><span class="n">first_or_last</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Adjust mask</span>
        <span class="c1"># self.hsi._mask[self.zr.zero_row, :] *= 0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.opChange"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.opChange">[docs]</a>    <span class="k">def</span> <span class="nf">opChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Math operation performed on single-color images changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxOperations</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">currentop</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.condOpChange"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.condOpChange">[docs]</a>    <span class="k">def</span> <span class="nf">condOpChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conditional math operation performed on single-color images changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondOps</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condoperation</span> <span class="o">=</span> <span class="n">currentop</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.condInEqualityChange"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.condInEqualityChange">[docs]</a>    <span class="k">def</span> <span class="nf">condInEqualityChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conditional inequality changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondInEquality</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">inequality</span> <span class="o">=</span> <span class="n">currentop</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.spinBoxInEqualityChange"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.spinBoxInEqualityChange">[docs]</a>    <span class="k">def</span> <span class="nf">spinBoxInEqualityChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conditional inequality value changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">inequalityval</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxInEquality</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.doKK"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.doKK">[docs]</a>    <span class="k">def</span> <span class="nf">doKK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pop-up Kramers-Kronig parameter entry dialog and perform</span>
<span class="sd">        the Kramers-Kronig phase retrieval algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUsePreviewROI</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()):</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                    <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_preview_spectra</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">nrb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># Range of pixels to perform-over</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">DialogKKOptions</span><span class="o">.</span><span class="n">dialogKKOptions</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                    <span class="n">nrb</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span>
                                                    <span class="n">preview_spectra</span><span class="p">],</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cars_amp_offset</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;cars_amp&#39;</span><span class="p">]</span>
            <span class="n">nrb_amp_offset</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;nrb_amp&#39;</span><span class="p">]</span>
            <span class="n">phase_offset</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;phase_offset&#39;</span><span class="p">]</span>
            <span class="n">norm_to_nrb</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;norm_to_nrb&#39;</span><span class="p">]</span>
            <span class="n">pad_factor</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;pad_factor&#39;</span><span class="p">]</span>

            <span class="n">kk</span> <span class="o">=</span> <span class="n">KramersKronig</span><span class="p">(</span><span class="n">cars_amp_offset</span><span class="o">=</span><span class="n">cars_amp_offset</span><span class="p">,</span>
                               <span class="n">nrb_amp_offset</span><span class="o">=</span><span class="n">nrb_amp_offset</span><span class="p">,</span>
                               <span class="n">phase_offset</span><span class="o">=</span><span class="n">phase_offset</span><span class="p">,</span> <span class="n">norm_to_nrb</span><span class="o">=</span><span class="n">norm_to_nrb</span><span class="p">,</span>
                               <span class="n">pad_factor</span><span class="o">=</span><span class="n">pad_factor</span><span class="p">,</span>
                               <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">kk</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;KK&#39;</span><span class="p">,</span> <span class="s1">&#39;CARSAmp&#39;</span><span class="p">,</span> <span class="n">cars_amp_offset</span><span class="p">,</span> <span class="s1">&#39;NRBAmp&#39;</span><span class="p">,</span>
                                 <span class="n">nrb_amp_offset</span><span class="p">,</span> <span class="s1">&#39;Phase&#39;</span><span class="p">,</span> <span class="n">phase_offset</span><span class="p">,</span>
                                 <span class="s1">&#39;Norm&#39;</span><span class="p">,</span> <span class="n">norm_to_nrb</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.deNoiseNRB"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.deNoiseNRB">[docs]</a>    <span class="k">def</span> <span class="nf">deNoiseNRB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Denoise NRB with Savitky-Golay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Range of pixels to perform-over</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetSG</span><span class="p">(</span><span class="n">window_length</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">],</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">win_size</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;polyorder&#39;</span><span class="p">]</span>

            <span class="n">nrb_denoise</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="n">nrb_denoise</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span> <span class="o">=</span> <span class="n">_sg</span><span class="p">(</span><span class="n">nrb_denoise</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span> <span class="n">win_size</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">nrb_denoise</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;DenoiseNrbSG&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;Win_size&#39;</span><span class="p">,</span> <span class="n">win_size</span><span class="p">,</span>
                                 <span class="s1">&#39;Order&#39;</span><span class="p">,</span> <span class="n">order</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.deNoiseDark"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.deNoiseDark">[docs]</a>    <span class="k">def</span> <span class="nf">deNoiseDark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Denoise Dark with Savitky-Golay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Range of pixels to perform-over</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetSG</span><span class="p">(</span><span class="n">window_length</span><span class="o">=</span><span class="mi">201</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">],</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">win_size</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;polyorder&#39;</span><span class="p">]</span>

            <span class="n">dark_denoise</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="n">dark_denoise</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span> <span class="o">=</span> <span class="n">_sg</span><span class="p">(</span><span class="n">dark_denoise</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span> <span class="n">win_size</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dark_denoise</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;DenoiseDarkSG&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;Win_size&#39;</span><span class="p">,</span> <span class="n">win_size</span><span class="p">,</span>
                                 <span class="s1">&#39;Order&#39;</span><span class="p">,</span> <span class="n">order</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.deNoise"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.deNoise">[docs]</a>    <span class="k">def</span> <span class="nf">deNoise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SVD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Range of pixels to perform-over</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>
        <span class="c1"># SVD Decompose</span>
        <span class="n">svd_decompose</span> <span class="o">=</span> <span class="n">SVDDecompose</span><span class="p">(</span><span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
        <span class="n">UsVh</span> <span class="o">=</span> <span class="n">svd_decompose</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Class method route</span>
        <span class="k">if</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Note: .main in dialog_AbstractFactorization</span>
            <span class="n">svs</span> <span class="o">=</span> <span class="n">DialogSVD</span><span class="o">.</span><span class="n">dialogSVD</span><span class="p">(</span><span class="n">UsVh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                                      <span class="n">img_all</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
                                      <span class="n">spect_all</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
                                      <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">svs</span> <span class="o">=</span> <span class="n">DialogSVD</span><span class="o">.</span><span class="n">dialogSVD</span><span class="p">(</span><span class="n">UsVh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                      <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                                      <span class="n">img_all</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
                                      <span class="n">spect_all</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
                                      <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SV</span><span class="se">\&#39;</span><span class="s1">s:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svs</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">svs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">svd_recompose</span> <span class="o">=</span> <span class="n">SVDRecompose</span><span class="p">(</span><span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">svd_recompose</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">UsVh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">UsVh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">UsVh</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="n">svs</span><span class="o">=</span><span class="n">svs</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;SVD&#39;</span><span class="p">,</span> <span class="s1">&#39;SVs&#39;</span><span class="p">,</span> <span class="n">svs</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.errorCorrectPhase"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.errorCorrectPhase">[docs]</a>    <span class="k">def</span> <span class="nf">errorCorrectPhase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error Correction: Phase</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUsePreviewROI</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()):</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                    <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_preview_spectra</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">preview_spectra</span><span class="p">):</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">preview_spectra</span><span class="p">)</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetALS</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="n">preview_spectra</span><span class="p">,</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># asym_param = winPlotEffect.parameters[&#39;asym_param&#39;]</span>
            <span class="c1"># smoothness_param = winPlotEffect.parameters[&#39;smoothness_param&#39;]</span>
            <span class="c1"># redux_factor = winPlotEffect.parameters[&#39;redux&#39;]</span>
            <span class="c1"># fix_end_points = winPlotEffect.parameters[&#39;fix_end_points&#39;]</span>
            <span class="c1"># max_iter = winPlotEffect.parameters[&#39;max_iter&#39;]</span>
            <span class="c1"># min_diff = winPlotEffect.parameters[&#39;min_diff&#39;]</span>

            <span class="n">phase_err_correct_als</span> <span class="o">=</span> <span class="n">_PhaseErrCorrectALS</span><span class="p">(</span><span class="o">**</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

            <span class="n">phase_err_correct_als</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PhaseErrorCorrectALS&#39;</span><span class="p">]</span>
            <span class="p">[</span><span class="n">temp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="c1"># Backup for Undo</span>
            <span class="c1"># if _np.size(asym_param) == 1:</span>
            <span class="c1">#     self.bcpre.add_step([&#39;PhaseErrorCorrectALS&#39;,</span>
            <span class="c1">#                          &#39;smoothness_param&#39;, smoothness_param,</span>
            <span class="c1">#                          &#39;asym_param&#39;, asym_param,</span>
            <span class="c1">#                          &#39;redux&#39;, redux_factor,</span>
            <span class="c1">#                          &#39;order&#39;, 2,</span>
            <span class="c1">#                          &#39;fix_end_points&#39;, fix_end_points,</span>
            <span class="c1">#                          &#39;max_iter&#39;, max_iter,</span>
            <span class="c1">#                          &#39;min_diff&#39;, min_diff])</span>

            <span class="c1"># else:</span>
            <span class="c1">#     self.bcpre.add_step([&#39;PhaseErrorCorrectALS&#39;,</span>
            <span class="c1">#                          &#39;smoothness_param&#39;, smoothness_param,</span>
            <span class="c1">#                          &#39;asym_param_start&#39;,</span>
            <span class="c1">#                          winPlotEffect.parameters[&#39;asym_param_start&#39;],</span>
            <span class="c1">#                          &#39;asym_param_end&#39;,</span>
            <span class="c1">#                          winPlotEffect.parameters[&#39;asym_param_end&#39;],</span>
            <span class="c1">#                          &#39;redux&#39;, redux_factor,</span>
            <span class="c1">#                          &#39;order&#39;, 2,</span>
            <span class="c1">#                          &#39;fix_end_points&#39;, fix_end_points,</span>
            <span class="c1">#                          &#39;max_iter&#39;, max_iter,</span>
            <span class="c1">#                          &#39;min_diff&#39;, min_diff])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.errorCorrectScale"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.errorCorrectScale">[docs]</a>    <span class="k">def</span> <span class="nf">errorCorrectScale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error Correction: Scale</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUsePreviewROI</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()):</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                    <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_preview_spectra</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">preview_spectra</span><span class="p">):</span>
                <span class="n">preview_spectra</span> <span class="o">=</span> <span class="n">preview_spectra</span><span class="o">.</span><span class="n">real</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetSG</span><span class="p">(</span><span class="n">window_length</span><span class="o">=</span><span class="mi">601</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="n">preview_spectra</span><span class="p">,</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">win_size</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;polyorder&#39;</span><span class="p">]</span>

            <span class="n">scale_err_correct_sg</span> <span class="o">=</span> <span class="n">_ScaleErrCorrectSG</span><span class="p">(</span><span class="n">win_size</span><span class="o">=</span><span class="n">win_size</span><span class="p">,</span>
                                                      <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
                                                      <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">scale_err_correct_sg</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;ScaleErrorCorrectSG&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;win_size&#39;</span><span class="p">,</span> <span class="n">win_size</span><span class="p">,</span>
                                 <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="n">order</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.errorCorrectAmp"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.errorCorrectAmp">[docs]</a>    <span class="k">def</span> <span class="nf">errorCorrectAmp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error Correction: Amp aka Baseline Detrending</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If data is complex, amplitude detrending occurs on and only on the \</span>
<span class="sd">        imaginary portion</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preview_rois</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUsePreviewROI</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()):</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                    <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">preview_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_preview_spectra</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">preview_spectra</span><span class="p">):</span>
                <span class="n">preview_spectra</span> <span class="o">=</span> <span class="n">preview_spectra</span><span class="o">.</span><span class="n">imag</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetALS</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="n">preview_spectra</span><span class="p">,</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># asym_param = winPlotEffect.parameters[&#39;asym_param&#39;]</span>
            <span class="c1"># smoothness_param = winPlotEffect.parameters[&#39;smoothness_param&#39;]</span>
            <span class="c1"># redux_factor = winPlotEffect.parameters[&#39;redux&#39;]</span>
            <span class="c1"># fix_end_points = winPlotEffect.parameters[&#39;fix_end_points&#39;]</span>
            <span class="c1"># max_iter = winPlotEffect.parameters[&#39;max_iter&#39;]</span>
            <span class="c1"># min_diff = winPlotEffect.parameters[&#39;min_diff&#39;]</span>

            <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AmpErrorCorrectALS&#39;</span><span class="p">]</span>
            <span class="p">[</span><span class="n">temp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

            <span class="n">baseline_detrend</span> <span class="o">=</span> <span class="n">_SubtractBaselineALS</span><span class="p">(</span><span class="o">**</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

            <span class="n">baseline_detrend</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="c1"># if _np.size(asym_param) == 1:</span>
            <span class="c1">#     self.bcpre.add_step([&#39;AmpErrorCorrectALS&#39;,</span>
            <span class="c1">#                          &#39;smoothness_param&#39;, smoothness_param,</span>
            <span class="c1">#                          &#39;asym_param&#39;, asym_param,</span>
            <span class="c1">#                          &#39;redux&#39;, redux_factor,</span>
            <span class="c1">#                          &#39;order&#39;, 2,</span>
            <span class="c1">#                          &#39;fix_end_points&#39;, fix_end_points,</span>
            <span class="c1">#                          &#39;max_iter&#39;, max_iter,</span>
            <span class="c1">#                          &#39;min_diff&#39;, min_diff])</span>
            <span class="c1"># else:</span>
            <span class="c1">#     self.bcpre.add_step([&#39;AmpErrorCorrectALS&#39;,</span>
            <span class="c1">#                          &#39;smoothness_param&#39;, smoothness_param,</span>
            <span class="c1">#                          &#39;asym_param_start&#39;,</span>
            <span class="c1">#                          winPlotEffect.parameters[&#39;asym_param_start&#39;],</span>
            <span class="c1">#                          &#39;asym_param_end&#39;,</span>
            <span class="c1">#                          winPlotEffect.parameters[&#39;asym_param_end&#39;],</span>
            <span class="c1">#                          &#39;redux&#39;, redux_factor,</span>
            <span class="c1">#                          &#39;order&#39;, 2,</span>
            <span class="c1">#                          &#39;fix_end_points&#39;, fix_end_points,</span>
            <span class="c1">#                          &#39;max_iter&#39;, max_iter,</span>
            <span class="c1">#                          &#39;min_diff&#39;, min_diff])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.doUndo"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.doUndo">[docs]</a>    <span class="k">def</span> <span class="nf">doUndo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Undo last operation back to last backup point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">pop_to_last</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">_BCPre</span><span class="o">.</span><span class="n">load_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>

        <span class="n">del_flag</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="s1">&#39;.pickle&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in deleting old pickle files&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">del_flag</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">del_flag</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Did not delete pickle file cut list... Something went wrong&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.subDark"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.subDark">[docs]</a>    <span class="k">def</span> <span class="nf">subDark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subtract loaded dark spectrum from HSI data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nrbloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">nrbloaded_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">nrbloaded_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">darkloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">darkloaded</span><span class="p">:</span>
                <span class="c1"># Instantiate SubtractDark</span>
                <span class="n">sub_dark</span> <span class="o">=</span> <span class="n">SubtractDark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Dark Spectrum from Image?&#39;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm dark subtract from image&#39;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                    <span class="n">sub_dark</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                    <span class="c1"># Backup for Undo</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;SubDark&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">nrbloaded</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Dark Spectrum from NRB Spectrum(a)?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm dark subtract from NRB spectrum(a)&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_dark</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded_left</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Dark Spectrum from Left-Side NRB Spectrum(a)?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm dark subtract from Left-Side NRB spectrum(a)&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_dark</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded_right</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Dark Spectrum from Right-Side NRB Spectrum(a)?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm dark subtract from Right-Side NRB spectrum(a)&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_dark</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Dark spectrum not loaded.&#39;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Image data not loaded. Cannot subtract dark spectrum.&#39;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.subResidual"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.subResidual">[docs]</a>    <span class="k">def</span> <span class="nf">subResidual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subtract a linear residual over range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nrbloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">nrbloaded_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">nrbloaded_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">imgloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">nrbloaded</span> <span class="ow">or</span> <span class="n">imgloaded</span><span class="p">:</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">_QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Frequency Window&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;Range Tuple (cm-1): &#39;</span><span class="p">,</span>
                                             <span class="n">text</span><span class="o">=</span><span class="s1">&#39;(-1500, -500)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="n">text_str_list</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">freqwin</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">text_str_list</span><span class="p">]</span>
                <span class="n">freqwin</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

                <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="n">freqwin</span><span class="p">)</span>
                <span class="n">sub_residual</span> <span class="o">=</span> <span class="n">SubtractMeanOverRange</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">imgloaded</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Residual Dark Spectrum from Image?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm residual subtraction from Image&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out_img</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out_img</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_residual</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Residual Dark Spectrum from NRB?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm residual subtraction from NRB&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_residual</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded_left</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Residual Dark Spectrum from Left-Side NRB?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm residual subtraction from Left-Side NRB&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_residual</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded_right</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Residual Dark Spectrum from Right-Side NRB?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm residual subtraction from Right-Side NRB&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_residual</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="c1"># Backup for Undo</span>
                <span class="k">if</span> <span class="n">out_img</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;SubResidual&#39;</span><span class="p">,</span><span class="s1">&#39;RangeStart&#39;</span><span class="p">,</span>
                                         <span class="n">freqwin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;RangeEnd&#39;</span><span class="p">,</span>
                                         <span class="n">freqwin</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Image or NRB data need be loaded.&#39;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.anscombe"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.anscombe">[docs]</a>    <span class="k">def</span> <span class="nf">anscombe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performance Anscombe transformation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">DialogAnscombeOptions</span><span class="o">.</span><span class="n">dialogAnscombeOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">DialogAnscombeOptions</span><span class="o">.</span><span class="n">dialogAnscombeOptions</span><span class="p">(</span><span class="n">stddev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span>
                                                              <span class="n">gain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">],</span>
                                                              <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

            <span class="n">ansc</span> <span class="o">=</span> <span class="n">_Anscombe</span><span class="p">(</span><span class="n">gauss_std</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span> <span class="n">gauss_mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                             <span class="n">poisson_multi</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">],</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">ansc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;Anscombe&#39;</span><span class="p">,</span><span class="s1">&#39;Gauss_mean&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                                 <span class="s1">&#39;Gauss_std&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;Poisson_multi&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.inverseAnscombe"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.inverseAnscombe">[docs]</a>    <span class="k">def</span> <span class="nf">inverseAnscombe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performance an Inverse Anscombe transformation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">DialogAnscombeOptions</span><span class="o">.</span><span class="n">dialogAnscombeOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">DialogAnscombeOptions</span><span class="o">.</span><span class="n">dialogAnscombeOptions</span><span class="p">(</span><span class="n">stddev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span>
                                                              <span class="n">gain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">],</span>
                                                              <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

            <span class="n">iansc</span> <span class="o">=</span> <span class="n">_AnscombeInverse</span><span class="p">(</span><span class="n">gauss_std</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span> <span class="n">gauss_mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                     <span class="n">poisson_multi</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">],</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">iansc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;InvAnscombe&#39;</span><span class="p">,</span><span class="s1">&#39;Gauss_mean&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                                 <span class="s1">&#39;Gauss_std&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;Poisson_multi&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateHistory</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.calcAnscombeParams"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.calcAnscombeParams">[docs]</a>    <span class="k">def</span> <span class="nf">calcAnscombeParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Anscombe Parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dark_sub</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="s1">&#39;Dark&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">attr_dict</span><span class="p">])</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">DialogCalcAnscombeParams</span><span class="o">.</span><span class="n">dialogCalcAnscombeParams</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">dark_array</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                                <span class="n">rep_array</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> 
                                                                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">,</span>
                                                                <span class="n">dark_sub</span><span class="o">=</span><span class="n">dark_sub</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stddev&#39;</span><span class="p">:</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;g_std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s1">&#39;gain&#39;</span><span class="p">:</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;weighted_mean_alpha&#39;</span><span class="p">],</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;g_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()}</span></div>

<div class="viewcode-block" id="CRIkitUI_process.doMath"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.doMath">[docs]</a>    <span class="k">def</span> <span class="nf">doMath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform selected math operation on single-color imagery.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Which RGB image is it</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="c1"># Which operation is selected</span>
        <span class="n">operation_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondOps</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">operation_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondOps</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>


        <span class="k">if</span> <span class="n">operation_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_freq_needed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># num_freq_needed = widgetColorMath.OPERATION_FREQ_COUNT[operation_index-1]</span>
            <span class="n">num_freq_needed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">OPERATION_FREQ_COUNT</span><span class="p">[</span><span class="n">operation_index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Check conditional frequencies are set</span>
        <span class="n">cond_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Conditional frequency LOCATION 1</span>
            <span class="n">condloc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">cond_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Conditional frequency LOCATIONS</span>
            <span class="n">condloc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span><span class="p">)</span>
            <span class="n">condloc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq2</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">cond_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Conditional frequency LOCATIONS</span>
            <span class="n">condloc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span><span class="p">)</span>
            <span class="n">condloc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq2</span><span class="p">)</span>
            <span class="n">condloc3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq3</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">cond_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cond_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">cond_set</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondOps</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Mask</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">):</span>  <span class="c1"># Return just a plane</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeak</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                     <span class="n">condloc1</span><span class="p">)</span>


            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>  <span class="c1"># Addition</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakAdd</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                        <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>  <span class="c1"># Subtraction</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMinus</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                          <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>  <span class="c1"># Multiplication</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMultiply</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                             <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="c1"># Division</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakDivide</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                           <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;SUM&#39;</span><span class="p">:</span>  <span class="c1"># Summation over range</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakSum</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                              <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;SUM(ABS(Re) + 1j*ABS(Im))&#39;</span><span class="p">:</span>  <span class="c1"># Abs of Re and Im</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakSumAbsReImag</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                                       <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;Peak b/w troughs&#39;</span><span class="p">:</span>  <span class="c1"># Peak between troughs</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakBWTroughs</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                              <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">,</span> <span class="n">condloc3</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;Max&#39;</span><span class="p">:</span>  <span class="c1"># Max over range</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMax</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                        <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;Min&#39;</span><span class="p">:</span>  <span class="c1"># Min over range</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMin</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                        <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;MaxAbs&#39;</span><span class="p">:</span>  <span class="c1"># Max of Abs value over range</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMaxAbs</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                           <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;MinAbs&#39;</span><span class="p">:</span>  <span class="c1"># Min of Abs value over range</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMinAbs</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                           <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">Mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUseImagData</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span><span class="o">.</span><span class="n">imag</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span><span class="o">.</span><span class="n">real</span>


        <span class="k">if</span> <span class="n">cond_set</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">inequality_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondInEquality</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="n">inequality_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxInEquality</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">inequality_text</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">&lt;</span> <span class="n">inequality_val</span>
            <span class="k">elif</span> <span class="n">inequality_text</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">&gt;</span> <span class="n">inequality_val</span>
            <span class="k">elif</span> <span class="n">inequality_text</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">==</span> <span class="n">inequality_val</span>
            <span class="k">elif</span> <span class="n">inequality_text</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">&gt;=</span> <span class="n">inequality_val</span>
            <span class="k">elif</span> <span class="n">inequality_text</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">&lt;=</span> <span class="n">inequality_val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inequality type error... setting to 1&#39;</span><span class="p">)</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Check frequencies are set</span>
        <span class="n">operation_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxOperations</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">operation_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxOperations</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="c1"># num_freq_needed = widgetColorMath.OPERATION_FREQ_COUNT[operation_index]</span>
        <span class="n">num_freq_needed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">OPERATION_FREQ_COUNT</span><span class="p">[</span><span class="n">operation_index</span><span class="p">]</span>

        <span class="n">freq_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Operating frequency LOCATION 1</span>
            <span class="n">oploc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">freq_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Operating frequency LOCATIONS</span>
            <span class="n">oploc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span><span class="p">)</span>
            <span class="n">oploc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq2</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">freq_set</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Operating frequency LOCATIONS</span>
            <span class="n">oploc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span><span class="p">)</span>
            <span class="n">oploc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq2</span><span class="p">)</span>
            <span class="n">oploc3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq3</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">freq_set</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">freq_set</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">):</span>  <span class="c1"># Return just a plane</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeak</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                  <span class="n">oploc1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>  <span class="c1"># Addition</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakAdd</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                     <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>  <span class="c1"># Subtraction</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMinus</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                       <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>  <span class="c1"># Multiplication</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMultiply</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                          <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="c1"># Division</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakDivide</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                        <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;SUM&#39;</span><span class="p">:</span>  <span class="c1"># Division</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakSum</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                           <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;SUM(ABS(Re) + 1j*ABS(Im))&#39;</span><span class="p">:</span>  <span class="c1"># Division</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakSumAbsReImag</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                              <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>                                               
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;Peak b/w troughs&#39;</span><span class="p">:</span>  <span class="c1"># Division</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakBWTroughs</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                                           <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">,</span>
                                                           <span class="n">oploc3</span><span class="p">)</span>                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="p">)</span> <span class="o">&amp;</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUseImagData</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="o">.</span><span class="n">imag</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="o">.</span><span class="n">real</span>
            
            
            <span class="n">minner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">minner</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">minner</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">minner</span><span class="p">))</span>

            <span class="n">maxer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">maxer</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">maxer</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">maxer</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="n">minner</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">maxer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="n">minner</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">maxer</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setOpFreq1"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setOpFreq1">[docs]</a>    <span class="k">def</span> <span class="nf">setOpFreq1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math frequency #1 (the primary frequency)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span>

            <span class="n">minner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">minner</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">minner</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">minner</span><span class="p">))</span>

            <span class="n">maxer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">maxer</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">maxer</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">maxer</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="n">minner</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">maxer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="n">minner</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">gsinfo</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">maxer</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setOpFreq2"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setOpFreq2">[docs]</a>    <span class="k">def</span> <span class="nf">setOpFreq2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math frequency #2 (e.g., freq #1 + freq #2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq2</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq2</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setOpFreq3"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setOpFreq3">[docs]</a>    <span class="k">def</span> <span class="nf">setOpFreq3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math frequency #3 (e.g., Amplitude at freq #1 - interpolation [freq #2, freq #3])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq3</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq3</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setCondFreq1"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setCondFreq1">[docs]</a>    <span class="k">def</span> <span class="nf">setCondFreq1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math conditional frequency #1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setCondFreq2"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setCondFreq2">[docs]</a>    <span class="k">def</span> <span class="nf">setCondFreq2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math conditional frequency #2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq2</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq2</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setCondFreq3"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setCondFreq3">[docs]</a>    <span class="k">def</span> <span class="nf">setCondFreq3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math conditional frequency #1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq3</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq3</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.spectrumColorImg"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.spectrumColorImg">[docs]</a>    <span class="k">def</span> <span class="nf">spectrumColorImg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate plot of mean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Which RGB image is it</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="n">Mask</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Mask</span> <span class="o">*=</span> <span class="n">Mask</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setmin</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Mask</span> <span class="o">*=</span> <span class="n">Mask</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setmax</span>

        <span class="k">if</span> <span class="n">Mask</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>

            <span class="n">mask_hits</span> <span class="o">=</span> <span class="n">Mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>


            <span class="n">mloc</span><span class="p">,</span> <span class="n">nloc</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Mask</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">_h5py</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>

                    <span class="c1"># * Can&#39;t do fancy boolean indexing with HDF</span>
                    <span class="c1"># * Make a square bounding box</span>

                    <span class="n">rmin</span> <span class="o">=</span> <span class="n">mloc</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="n">rmax</span> <span class="o">=</span> <span class="n">mloc</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">cmin</span> <span class="o">=</span> <span class="n">nloc</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="n">cmax</span> <span class="o">=</span> <span class="n">nloc</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>

                    <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">rmin</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span> <span class="n">cmin</span><span class="p">:</span><span class="n">cmax</span><span class="p">,:][</span><span class="n">Mask</span><span class="p">[</span><span class="n">rmin</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span> <span class="n">cmin</span><span class="p">:</span><span class="n">cmax</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUseImagData</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">spectra</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">imag</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">spectra</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">real</span>

                <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">stddev</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">])</span>
                    <span class="n">stddev</span> <span class="o">=</span> <span class="mi">0</span>
                    
                <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean spectrum (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mask_hits</span><span class="p">))</span>
                
                <span class="c1"># Check color of line b/c uses color cycler-- for fill_b/w</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">list_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>

                <span class="c1"># Alternative</span>
                <span class="c1">#color = self.plotter.modelLine._model_data[-1][&#39;color&#39;]</span>

                <span class="c1"># Plot +-1 std. dev.</span>
                <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">spectrum</span> <span class="o">-</span> <span class="n">stddev</span><span class="p">,</span>
                                              <span class="n">spectrum</span> <span class="o">+</span> <span class="n">stddev</span><span class="p">,</span>
                                              <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                              <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                                              <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\pm$1 Std. Dev. (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mask_hits</span><span class="p">))</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.createImgBW"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.createImgBW">[docs]</a>    <span class="k">def</span> <span class="nf">createImgBW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the single-frequency grayscale image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xunits</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">yunits</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">winextent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">createImg</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">xunits</span><span class="o">=</span><span class="n">xunits</span><span class="p">,</span>
                              <span class="n">yunits</span><span class="o">=</span><span class="n">yunits</span><span class="p">,</span>
                              <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">colormode</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxColormap</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkBoxFixed</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">maxer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">minner</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.changeSlider"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.changeSlider">[docs]</a>    <span class="k">def</span> <span class="nf">changeSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to change in frequency slider</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get current axis limits to reset to these</span>
        <span class="c1"># after refresh is performed</span>
        <span class="n">orig_axis_lims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">sliderPosition</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;Slider position need be an integer&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_list_pix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_list_pix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditPix</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span><span class="mi">2</span><span class="p">)))</span>
            <span class="c1"># Set BW Class Data</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">pos</span><span class="o">+</span><span class="n">offset</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUseImagData</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="o">.</span><span class="n">imag</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="o">.</span><span class="n">real</span>

            <span class="n">val_extrema</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="p">))</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMin</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxMax</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">val_extrema</span><span class="p">)</span>

            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

            <span class="c1"># print(&#39;Xlabel: {}&#39;.format(xlabel))</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">checkBoxRemOutliers</span><span class="p">()</span>
            <span class="c1"># if self.img_BW.ui.checkBoxFixed.checkState() == 0:</span>
            <span class="c1">#     self.img_BW.data.setmax = None</span>
            <span class="c1">#     self.img_BW.data.setmin = None</span>

            <span class="c1"># Set axis to original limits</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="n">orig_axis_lims</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpl_v1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in changeSlider: display img_BW&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_overlays</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

                    <span class="n">color</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
                    <span class="n">mfc</span> <span class="o">=</span> <span class="n">color</span>  <span class="c1"># Marker face color</span>
                    <span class="n">mec</span> <span class="o">=</span> <span class="n">color</span>  <span class="c1"># Marker edge color</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span>  <span class="c1"># Linewidth</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                    <span class="n">ls</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span>  <span class="c1"># Linestyle</span>
                    <span class="n">ms</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;markersize&#39;</span><span class="p">]</span>  <span class="c1"># Markersize</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
                    <span class="n">marker</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span>

                    <span class="c1"># Need some sort of marker if just a point</span>
                    <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">marker</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                                <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                                            <span class="n">mfc</span><span class="o">=</span><span class="n">mfc</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="n">mec</span><span class="p">,</span>
                                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span>
                                            <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                                            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowOverlayLegend</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># self.img_BW.mpl.ax.legend(loc=&#39;best&#39;)</span>
                            <span class="n">lg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> 
                                                            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;expand&#39;</span><span class="p">,</span> 
                                                            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                                                            <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">lg</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tight_layout failed (CrikitUI: 3&#39;</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in showing overlay legend&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in changeSlider: display overlays&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowPreviewROI</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showPreviewRois</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_flag</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.sliderPressed"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.sliderPressed">[docs]</a>    <span class="k">def</span> <span class="nf">sliderPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to press of frequency slider (set tracking of location)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setTracking</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.sliderReleased"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.sliderReleased">[docs]</a>    <span class="k">def</span> <span class="nf">sliderReleased</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to release of frequency slider (end tracking of location)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.checkCompositeUpdate"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.checkCompositeUpdate">[docs]</a>    <span class="k">def</span> <span class="nf">checkCompositeUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update color composite only if appropriate tab is selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.doComposite"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.doComposite">[docs]</a>    <span class="k">def</span> <span class="nf">doComposite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update color composite image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">initData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">changeMode</span><span class="p">()</span>  <span class="c1"># This checks what mode is set</span>

            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

            <span class="c1"># print(&#39;Xlabel: {}&#39;.format(xlabel))</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">createImg</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">,</span>
                                         <span class="n">xunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xunits</span><span class="p">,</span>
                                         <span class="n">yunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">yunits</span><span class="p">,</span>
                                         <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">winextent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">initData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">changeMode</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">createImg</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">,</span>
                                          <span class="n">xunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xunits</span><span class="p">,</span>
                                          <span class="n">yunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">yunits</span><span class="p">,</span>
                                          <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">winextent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in doComposite&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.updateOverlays"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.updateOverlays">[docs]</a>    <span class="k">def</span> <span class="nf">updateOverlays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">list_line_objs</span><span class="p">:</span>
            <span class="n">ms</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">model_style</span>

            <span class="c1"># Make sure there is the appropriate meta data</span>
            <span class="k">if</span> <span class="n">ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overlay&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ms</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="s1">&#39;overlay&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.deleteOverlays"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.deleteOverlays">[docs]</a>    <span class="k">def</span> <span class="nf">deleteOverlays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateOverlays</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.checkShowOverlays"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.checkShowOverlays">[docs]</a>    <span class="k">def</span> <span class="nf">checkShowOverlays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_overlays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowOverlays</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.makeRamanPhantom"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.makeRamanPhantom">[docs]</a>    <span class="k">def</span> <span class="nf">makeRamanPhantom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a numerical phantom for Raman</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cplx</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Is model complex-valued -- False for Raman</span>

        <span class="n">dialog</span> <span class="o">=</span> <span class="n">DialogModel</span><span class="o">.</span><span class="n">dialogModel</span><span class="p">(</span><span class="n">cplx</span><span class="o">=</span><span class="n">cplx</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dialog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">_Model</span><span class="p">(</span><span class="n">subsample</span><span class="o">=</span><span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;subsample&#39;</span><span class="p">])</span>

            <span class="n">wn_start</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;wn_start&#39;</span><span class="p">]</span>
            <span class="n">wn_end</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;wn_end&#39;</span><span class="p">]</span>

            <span class="n">lam_start</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">/</span> <span class="p">(</span><span class="n">wn_start</span> <span class="o">+</span> <span class="mf">0.01</span><span class="o">/</span><span class="p">(</span><span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;probe&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-9</span><span class="p">))</span>  <span class="c1"># meters</span>
            <span class="n">lam_start</span> <span class="o">*=</span> <span class="mf">1e9</span>  <span class="c1"># nm</span>

            <span class="n">lam_end</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">/</span> <span class="p">(</span><span class="n">wn_end</span> <span class="o">+</span> <span class="mf">0.01</span><span class="o">/</span><span class="p">(</span><span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;probe&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-9</span><span class="p">))</span>  <span class="c1"># meters</span>
            <span class="n">lam_end</span> <span class="o">*=</span> <span class="mf">1e9</span>  <span class="c1"># nm</span>

            <span class="n">lam_ctr</span> <span class="o">=</span> <span class="p">(</span><span class="n">lam_start</span> <span class="o">+</span> <span class="n">lam_end</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># nm</span>

            <span class="n">n_pix</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">lam_end</span><span class="o">-</span><span class="n">lam_start</span><span class="p">)</span> <span class="o">/</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;wl_slope&#39;</span><span class="p">])</span>

            <span class="c1"># Make a properly linear frequency-vector and polyfit</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;wl_slope&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_pix</span><span class="p">)</span>  <span class="c1"># Temporary frequency vec</span>
            <span class="n">f</span> <span class="o">-=</span> <span class="n">f</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">f</span> <span class="o">+=</span> <span class="n">lam_ctr</span>

            <span class="n">a_vec</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_pix</span><span class="p">),</span> <span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">calib</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a_vec&#39;</span><span class="p">:</span> <span class="n">a_vec</span><span class="p">,</span>
                     <span class="s1">&#39;ctr_wl&#39;</span><span class="p">:</span> <span class="n">lam_ctr</span><span class="p">,</span>
                     <span class="s1">&#39;ctr_wl0&#39;</span><span class="p">:</span> <span class="n">lam_ctr</span><span class="p">,</span>
                     <span class="s1">&#39;n_pix&#39;</span><span class="p">:</span> <span class="n">n_pix</span><span class="p">,</span>
                     <span class="s1">&#39;probe&#39;</span><span class="p">:</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;probe&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;nm&#39;</span><span class="p">}</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">_calib_pix_wn</span><span class="p">(</span><span class="n">calib</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">model</span><span class="o">.</span><span class="n">make_hsi</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cplx</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">imag</span>
                <span class="n">model</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

            <span class="c1"># For Raman -- make the Hsi more intense</span>
            <span class="c1"># This is ARBITRARY</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span> <span class="o">*=</span> <span class="mf">50e3</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib_fcn</span> <span class="o">=</span> <span class="n">_calib_pix_wn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span> <span class="o">=</span> <span class="n">calib</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

            <span class="n">add_gnoise</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;gnoise_bool&#39;</span><span class="p">]</span>  <span class="c1"># AWGN (Gaussian)</span>
            <span class="n">add_pnoise</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;pnoise_bool&#39;</span><span class="p">]</span>  <span class="c1"># Poisson noise</span>
            <span class="n">add_dark</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;dark_bool&#39;</span><span class="p">]</span>  <span class="c1"># Dark background -- just a constant</span>

            <span class="c1"># These values correspond to the defaults of the</span>
            <span class="c1"># Anscombe UI</span>
            <span class="n">g_noise</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;gnoise_stddev&#39;</span><span class="p">]</span>  <span class="c1"># Std Dev of Gaussian noise</span>
            <span class="n">p_amp</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;pnoise_gain&#39;</span><span class="p">]</span>  <span class="c1"># Multiplier of Poisson noise</span>
            <span class="n">dark_amp</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;dark_level&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">add_pnoise</span><span class="p">:</span>  <span class="c1"># Add Poisson noise</span>
                <span class="c1"># NOTE: CORRECT is p_amp*poisson(signal)</span>
                <span class="c1"># DEFINITELY NOT p_amp*(poisson(signal)-signal) + signal</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span> <span class="o">+=</span> <span class="n">p_amp</span><span class="o">*</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span>
            <span class="k">if</span> <span class="n">add_gnoise</span><span class="p">:</span>  <span class="c1"># Add AGWN</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span> <span class="o">+=</span> <span class="n">_np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_dark</span><span class="p">:</span>  <span class="c1"># Add a constant dark background</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span> <span class="o">+=</span> <span class="n">dark_amp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">dark_amp</span> <span class="o">+</span> <span class="mi">0</span><span class="o">*</span><span class="n">f</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;Phantom.h5&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/RamanImage/Phantom_v0/Phantom_v0&#39;</span><span class="p">]</span>

            <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Calib.a_vec&#39;</span><span class="p">:</span> <span class="n">a_vec</span><span class="p">,</span>
                    <span class="s1">&#39;Calib.ctr_wl&#39;</span><span class="p">:</span> <span class="n">lam_ctr</span><span class="p">,</span>
                    <span class="s1">&#39;Calib.ctr_wl0&#39;</span><span class="p">:</span> <span class="n">lam_ctr</span><span class="p">,</span>
                    <span class="s1">&#39;Calib.n_pix&#39;</span><span class="p">:</span> <span class="n">n_pix</span><span class="p">,</span>
                    <span class="s1">&#39;Calib.probe&#39;</span><span class="p">:</span> <span class="n">calib</span><span class="p">[</span><span class="s1">&#39;probe&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;Calib.units&#39;</span><span class="p">:</span> <span class="s1">&#39;nm&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Memo&#39;</span><span class="p">:</span> <span class="s1">&#39;Numerical phantom from murine pancreas artery. See Camp et al, JRS (2016).&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.FastAxis&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.FastAxisStart&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;RasterScanParams.FastAxisStepSize&#39;</span><span class="p">:</span> <span class="n">_np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="s1">&#39;RasterScanParams.FastAxisSteps&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.FastAxisStop&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;RasterScanParams.FixedAxis&#39;</span><span class="p">:</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.FixedAxisPosition&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.SlowAxis&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.SlowAxisStart&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;RasterScanParams.SlowAxisStepSize&#39;</span><span class="p">:</span> <span class="n">_np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="s1">&#39;RasterScanParams.SlowAxisSteps&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.SlowAxisStop&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;Spectro.CenterWavelength&#39;</span><span class="p">:</span> <span class="n">lam_ctr</span><span class="p">,</span>
                    <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="n">meta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenSuccess</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="CRIkitUI_process.makeBCARSPhantom"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.makeBCARSPhantom">[docs]</a>    <span class="k">def</span> <span class="nf">makeBCARSPhantom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a numerical phantom for BCARS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cplx</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Is model complex-valued -- True for BCARS</span>

        <span class="n">dialog</span> <span class="o">=</span> <span class="n">DialogModel</span><span class="o">.</span><span class="n">dialogModel</span><span class="p">(</span><span class="n">cplx</span><span class="o">=</span><span class="n">cplx</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dialog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">_Model</span><span class="p">(</span><span class="n">subsample</span><span class="o">=</span><span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;subsample&#39;</span><span class="p">])</span>

            <span class="n">wn_start</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;wn_start&#39;</span><span class="p">]</span>
            <span class="n">wn_end</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;wn_end&#39;</span><span class="p">]</span>

            <span class="n">lam_start</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">/</span> <span class="p">(</span><span class="n">wn_start</span> <span class="o">+</span> <span class="mf">0.01</span><span class="o">/</span><span class="p">(</span><span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;probe&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-9</span><span class="p">))</span>  <span class="c1"># meters</span>
            <span class="n">lam_start</span> <span class="o">*=</span> <span class="mf">1e9</span>  <span class="c1"># nm</span>

            <span class="n">lam_end</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">/</span> <span class="p">(</span><span class="n">wn_end</span> <span class="o">+</span> <span class="mf">0.01</span><span class="o">/</span><span class="p">(</span><span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;probe&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-9</span><span class="p">))</span>  <span class="c1"># meters</span>
            <span class="n">lam_end</span> <span class="o">*=</span> <span class="mf">1e9</span>  <span class="c1"># nm</span>

            <span class="n">lam_ctr</span> <span class="o">=</span> <span class="p">(</span><span class="n">lam_start</span> <span class="o">+</span> <span class="n">lam_end</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># nm</span>

            <span class="n">n_pix</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">lam_end</span><span class="o">-</span><span class="n">lam_start</span><span class="p">)</span> <span class="o">/</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;wl_slope&#39;</span><span class="p">])</span>

            <span class="c1"># Make a properly linear frequency-vector and polyfit</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;wl_slope&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_pix</span><span class="p">)</span>  <span class="c1"># Temporary frequency vec</span>
            <span class="n">f</span> <span class="o">-=</span> <span class="n">f</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">f</span> <span class="o">+=</span> <span class="n">lam_ctr</span>

            <span class="n">a_vec</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_pix</span><span class="p">),</span> <span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">calib</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a_vec&#39;</span><span class="p">:</span> <span class="n">a_vec</span><span class="p">,</span>
                     <span class="s1">&#39;ctr_wl&#39;</span><span class="p">:</span> <span class="n">lam_ctr</span><span class="p">,</span>
                     <span class="s1">&#39;ctr_wl0&#39;</span><span class="p">:</span> <span class="n">lam_ctr</span><span class="p">,</span>
                     <span class="s1">&#39;n_pix&#39;</span><span class="p">:</span> <span class="n">n_pix</span><span class="p">,</span>
                     <span class="s1">&#39;probe&#39;</span><span class="p">:</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;probe&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;nm&#39;</span><span class="p">}</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">_calib_pix_wn</span><span class="p">(</span><span class="n">calib</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">model</span><span class="o">.</span><span class="n">make_hsi</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cplx</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">imag</span>
                <span class="n">model</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

            <span class="c1"># Simple Gaussian 0-centered source profile</span>
            <span class="n">source</span> <span class="o">=</span> <span class="mf">1e2</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">f</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">1500</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">nrb</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="mf">20e3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mf">10e3</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">+</span><span class="n">nrb</span><span class="p">)</span><span class="o">*</span><span class="n">source</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib_fcn</span> <span class="o">=</span> <span class="n">_calib_pix_wn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span> <span class="o">=</span> <span class="n">calib</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">source</span><span class="o">*</span><span class="n">nrb</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span>

            <span class="n">add_gnoise</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;gnoise_bool&#39;</span><span class="p">]</span>  <span class="c1"># AWGN (Gaussian)</span>
            <span class="n">add_pnoise</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;pnoise_bool&#39;</span><span class="p">]</span>  <span class="c1"># Poisson noise</span>
            <span class="n">add_dark</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;dark_bool&#39;</span><span class="p">]</span>  <span class="c1"># Dark background -- just a constant</span>

            <span class="c1"># These values correspond to the defaults of the</span>
            <span class="c1"># Anscombe UI</span>
            <span class="n">g_noise</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;gnoise_stddev&#39;</span><span class="p">]</span>  <span class="c1"># Std Dev of Gaussian noise</span>
            <span class="n">p_amp</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;pnoise_gain&#39;</span><span class="p">]</span>  <span class="c1"># Multiplier of Poisson noise</span>
            <span class="n">dark_amp</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="s1">&#39;dark_level&#39;</span><span class="p">]</span>

            <span class="c1"># Only dark added to NRB</span>
            <span class="c1"># Others only to Hsi data</span>
            <span class="k">if</span> <span class="n">add_pnoise</span><span class="p">:</span>  <span class="c1"># Add Poisson noise</span>
                <span class="c1"># NOTE: CORRECT is p_amp*poisson(signal)</span>
                <span class="c1"># DEFINITELY NOT p_amp*(poisson(signal)-signal) + signal</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span> <span class="o">+=</span> <span class="n">p_amp</span><span class="o">*</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span>
            <span class="k">if</span> <span class="n">add_gnoise</span><span class="p">:</span>  <span class="c1"># Add AGWN</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span> <span class="o">+=</span> <span class="n">_np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_dark</span><span class="p">:</span>  <span class="c1"># Add a constant dark background</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_data</span> <span class="o">+=</span> <span class="n">dark_amp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">_data</span> <span class="o">+=</span> <span class="n">dark_amp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">dark_amp</span> <span class="o">+</span> <span class="mi">0</span><span class="o">*</span><span class="n">f</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;Phantom.h5&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/BCARSImage/Phantom_v0/Phantom_v0&#39;</span><span class="p">]</span>

            <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Calib.a_vec&#39;</span><span class="p">:</span> <span class="n">a_vec</span><span class="p">,</span>
                    <span class="s1">&#39;Calib.ctr_wl&#39;</span><span class="p">:</span> <span class="n">lam_ctr</span><span class="p">,</span>
                    <span class="s1">&#39;Calib.ctr_wl0&#39;</span><span class="p">:</span> <span class="n">lam_ctr</span><span class="p">,</span>
                    <span class="s1">&#39;Calib.n_pix&#39;</span><span class="p">:</span> <span class="n">n_pix</span><span class="p">,</span>
                    <span class="s1">&#39;Calib.probe&#39;</span><span class="p">:</span> <span class="n">calib</span><span class="p">[</span><span class="s1">&#39;probe&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;Calib.units&#39;</span><span class="p">:</span> <span class="s1">&#39;nm&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Memo&#39;</span><span class="p">:</span> <span class="s1">&#39;Numerical phantom from murine pancreas artery. See Camp et al, JRS (2016).&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.FastAxis&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.FastAxisStart&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;RasterScanParams.FastAxisStepSize&#39;</span><span class="p">:</span> <span class="n">_np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="s1">&#39;RasterScanParams.FastAxisSteps&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.FastAxisStop&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;RasterScanParams.FixedAxis&#39;</span><span class="p">:</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.FixedAxisPosition&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.SlowAxis&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.SlowAxisStart&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;RasterScanParams.SlowAxisStepSize&#39;</span><span class="p">:</span> <span class="n">_np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="s1">&#39;RasterScanParams.SlowAxisSteps&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                    <span class="s1">&#39;RasterScanParams.SlowAxisStop&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;Spectro.CenterWavelength&#39;</span><span class="p">:</span> <span class="n">lam_ctr</span><span class="p">,</span>
                    <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="n">meta</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuCoherent_Raman_Imaging</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenSuccess</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.specialDemosaicRGB"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.specialDemosaicRGB">[docs]</a>    <span class="k">def</span> <span class="nf">specialDemosaicRGB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;You will need to select the MASK dataset associated with your mosaic image&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Select Mask file&#39;</span><span class="p">)</span>
        <span class="c1"># msg.setInformativeText(&#39;This should only be applied to RAW BCARS2 data from NIST.&#39;)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">to_open</span> <span class="o">=</span> <span class="n">HdfLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Mask Image&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_open</span> <span class="o">=</span> <span class="n">HdfLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Mask Image&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">_traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not open file. Corrupt or not appropriate file format.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">to_open</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Opening </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">))</span>
                <span class="k">with</span> <span class="n">_h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">lazy5</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pth</span><span class="o">=</span><span class="n">path</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
                    <span class="n">img_shape</span> <span class="o">=</span> <span class="n">fid</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_mosaic_mask</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">img_shape</span><span class="p">)</span>
                    <span class="n">fid</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span><span class="o">.</span><span class="n">read_direct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mosaic_mask</span><span class="p">)</span>
                    <span class="n">n_imgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mosaic_mask</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;You will need to select/create a directory to save the new images in&#39;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Select directory&#39;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">_QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Select Folder to Save Images&#39;</span><span class="p">,</span>
                                                          <span class="n">path</span><span class="p">)</span>

            
            <span class="k">for</span> <span class="n">num_rgb</span><span class="p">,</span> <span class="n">rgb_win</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">rgb_win</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">num_z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_imgs</span><span class="p">):</span>
                    <span class="n">save_name</span> <span class="o">=</span> <span class="s1">&#39;Color_</span><span class="si">{}</span><span class="s1">_z</span><span class="si">{}</span><span class="s1">.tiff&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_rgb</span><span class="p">,</span> <span class="n">num_z</span><span class="p">)</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mosaic_mask</span> <span class="o">==</span> <span class="n">num_z</span><span class="p">)</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">rgb_win</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">:]</span>
                    <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
                    <span class="n">_plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                    <span class="n">_plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
                    <span class="n">_plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">lazy5</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="n">save_name</span><span class="p">,</span> <span class="n">pth</span><span class="o">=</span><span class="n">save_path</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
                    <span class="n">_plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">num_z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_imgs</span><span class="p">):</span>
                <span class="n">save_name</span> <span class="o">=</span> <span class="s1">&#39;Composite_z</span><span class="si">{}</span><span class="s1">.tiff&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_z</span><span class="p">)</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mosaic_mask</span> <span class="o">==</span> <span class="n">num_z</span><span class="p">)</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">:]</span>
                <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
                <span class="n">_plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                <span class="n">_plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
                <span class="n">_plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">lazy5</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">fullpath</span><span class="p">(</span><span class="n">save_name</span><span class="p">,</span> <span class="n">pth</span><span class="o">=</span><span class="n">save_path</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
                <span class="n">_plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="crikit_launch"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.crikit_launch">[docs]</a><span class="k">def</span> <span class="nf">crikit_launch</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Command line launching of CRIkitUI.</span>

<span class="sd">    Input kwargs (Optional)</span>
<span class="sd">    ------------------------</span>
<span class="sd">    hsi : crikit.data.Hsi</span>
<span class="sd">        Hsi instance</span>

<span class="sd">    data : ndarray (3D)</span>
<span class="sd">        Numpy array (Y,X,Freq) hsi</span>

<span class="sd">    x : ndarray (1D)</span>
<span class="sd">        x-array</span>

<span class="sd">    x_units : str</span>
<span class="sd">        Units of x (e.g. r&#39;$\mu$m&#39;)</span>

<span class="sd">    x_label : str</span>
<span class="sd">        Label of x (e.g. &#39;X&#39;)</span>

<span class="sd">    y : ndarray (1D)</span>
<span class="sd">        y-array</span>

<span class="sd">    y_units : str</span>
<span class="sd">        Units of y (e.g. r&#39;$\mu$m&#39;)</span>

<span class="sd">    y_label : str</span>
<span class="sd">        Label of y (e.g. &#39;Y&#39;)</span>

<span class="sd">    f : ndarray (1D)</span>
<span class="sd">        frequency-array</span>

<span class="sd">    f_units : str</span>
<span class="sd">        Units of frequency (e.g. r&#39;cm$^{-1}$&#39;)</span>

<span class="sd">    f_label : str</span>
<span class="sd">        Label of frequency (e.g. &#39;Wavenumber&#39;)</span>

<span class="sd">    filename : str</span>
<span class="sd">        Filename of HDF data to auto-load (requires path and dataset_name as well)</span>

<span class="sd">    path : str</span>
<span class="sd">        Path of HDF data to auto-load (requires filename and dataset_name as well)</span>

<span class="sd">    dataset_name : str</span>
<span class="sd">        Dataset name(s) of HDF data to auto-load (requires path and filename as well)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">_QApplication</span><span class="p">(</span><span class="n">_sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="s1">&#39;Cleanlooks&#39;</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setQuitOnLastWindowClosed</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">parent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">_QWidget</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">parent</span>

    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="c1"># print(&#39;Kwargs: {}&#39;.format(kwargs))</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">CRIkitUI_process</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1">### EDIT ###</span>

    <span class="c1"># Insert other stuff to do</span>

    <span class="c1"># Final stuff</span>
    <span class="n">win</span><span class="o">.</span><span class="n">showMaximized</span><span class="p">()</span>
    <span class="c1">#win.plotter.lower()</span>
    <span class="c1">#win.raise_()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">None</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="kn">from</span> <span class="nn">crikit.ui.utils.check_requirements</span> <span class="k">import</span> <span class="n">check_requirements</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">_QApplication</span><span class="p">(</span><span class="n">_sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="s1">&#39;Cleanlooks&#39;</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setQuitOnLastWindowClosed</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">obj</span> <span class="o">=</span> <span class="n">_QWidget</span><span class="p">()</span>

    <span class="n">has_requirements</span> <span class="o">=</span> <span class="n">check_requirements</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">has_requirements</span><span class="p">:</span>
        <span class="n">win</span> <span class="o">=</span> <span class="n">CRIkitUI_process</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span> <span class="c1">### EDIT ###</span>
        <span class="n">win</span><span class="o">.</span><span class="n">showMaximized</span><span class="p">()</span>
        <span class="n">_sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="c1">#app.closeAllWindows()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CRIKit2 0.2.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>