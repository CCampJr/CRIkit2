

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>crikit.CRIkitUI &mdash; CRIKit2 17.10b1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="CRIKit2 17.10b1 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> CRIKit2
          

          
          </a>

          
            
            
              <div class="version">
                17.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installing.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../running.html">Running CRIkit2 UI</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CRIKit2</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>crikit.CRIkitUI</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for crikit.CRIkitUI</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CRIKit2: Hyperspectral imaging toolkit</span>
<span class="sd">==============================================================</span>

<span class="sd">CRIKit2, formerly the Coherent Raman Imaging toolKit, is a hyperspectral</span>
<span class="sd">imaging (HSI) platform (user interface, UI).</span>

<span class="sd">HSI Processing:</span>
<span class="sd">    * Dark subtraction</span>
<span class="sd">    * Detrending</span>
<span class="sd">    * Denoising</span>

<span class="sd">Coherent Raman-Specific Processing:</span>
<span class="sd">    * Kramers-Kronig phase retrieval</span>
<span class="sd">    * Phase- and scale-error correction</span>

<span class="sd">Analysis:</span>
<span class="sd">    * Coming soon</span>

<span class="sd">Usage</span>
<span class="sd">-----</span>
<span class="sd">From ./crikit2 directory</span>
<span class="sd">python3 main.py</span>

<span class="sd">Authors</span>
<span class="sd">-------</span>
<span class="sd">* Charles H. Camp Jr. &lt;charles.camp@nist.gov&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span> <span class="k">as</span> <span class="nn">_copy</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="k">as</span> <span class="nn">_os</span>
<span class="kn">import</span> <span class="nn">sys</span> <span class="k">as</span> <span class="nn">_sys</span>
<span class="kn">import</span> <span class="nn">webbrowser</span> <span class="k">as</span> <span class="nn">_webbrowser</span>

<span class="kn">import</span> <span class="nn">h5py</span> <span class="k">as</span> <span class="nn">_h5py</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">_mpl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">_np</span>
<span class="kn">import</span> <span class="nn">PyQt5.QtCore</span> <span class="k">as</span> <span class="nn">_QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="k">import</span> <span class="n">QCursor</span> <span class="k">as</span> <span class="n">_QCursor</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QApplication</span> <span class="k">as</span> <span class="n">_QApplication</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QFileDialog</span> <span class="k">as</span> <span class="n">_QFileDialog</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QInputDialog</span> <span class="k">as</span> <span class="n">_QInputDialog</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QMainWindow</span> <span class="k">as</span> <span class="n">_QMainWindow</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QMessageBox</span> <span class="k">as</span> <span class="n">_QMessageBox</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QWidget</span> <span class="k">as</span> <span class="n">_QWidget</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">savgol_filter</span> <span class="k">as</span> <span class="n">_sg</span>

<span class="kn">import</span> <span class="nn">crikit.measurement.peakamps</span> <span class="k">as</span> <span class="nn">_peakamps</span>
<span class="kn">from</span> <span class="nn">crikit.cri.error_correction</span> <span class="k">import</span> \
    <span class="n">PhaseErrCorrectALS</span> <span class="k">as</span> <span class="n">_PhaseErrCorrectALS</span>
<span class="kn">from</span> <span class="nn">crikit.cri.error_correction</span> <span class="k">import</span> <span class="n">ScaleErrCorrectSG</span> <span class="k">as</span> <span class="n">_ScaleErrCorrectSG</span>
<span class="kn">from</span> <span class="nn">crikit.cri.kk</span> <span class="k">import</span> <span class="n">KramersKronig</span>
<span class="kn">from</span> <span class="nn">crikit.cri.merge_nrbs</span> <span class="k">import</span> <span class="n">MergeNRBs</span> <span class="k">as</span> <span class="n">_MergeNRBs</span>
<span class="kn">from</span> <span class="nn">crikit.data.hsi</span> <span class="k">import</span> <span class="n">Hsi</span>
<span class="kn">from</span> <span class="nn">crikit.data.spectra</span> <span class="k">import</span> <span class="n">Spectra</span>
<span class="kn">from</span> <span class="nn">crikit.data.spectrum</span> <span class="k">import</span> <span class="n">Spectrum</span>
<span class="kn">from</span> <span class="nn">crikit.io.macros</span> <span class="k">import</span> <span class="n">import_csv_nist_special1</span> <span class="k">as</span> <span class="n">io_nist_dlm</span>
<span class="kn">from</span> <span class="nn">crikit.io.macros</span> <span class="k">import</span> <span class="n">import_hdf_nist_special</span> <span class="k">as</span> <span class="n">io_nist</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.crop</span> <span class="k">import</span> <span class="n">ZeroColumn</span> <span class="k">as</span> <span class="n">_ZeroColumn</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.crop</span> <span class="k">import</span> <span class="n">ZeroRow</span> <span class="k">as</span> <span class="n">_ZeroRow</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.denoise</span> <span class="k">import</span> <span class="n">SVDDecompose</span><span class="p">,</span> <span class="n">SVDRecompose</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.standardize</span> <span class="k">import</span> <span class="n">Anscombe</span> <span class="k">as</span> <span class="n">_Anscombe</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.standardize</span> <span class="k">import</span> <span class="n">AnscombeInverse</span> <span class="k">as</span> <span class="n">_AnscombeInverse</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.subtract_baseline</span> <span class="k">import</span> \
    <span class="n">SubtractBaselineALS</span> <span class="k">as</span> <span class="n">_SubtractBaselineALS</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.subtract_dark</span> <span class="k">import</span> <span class="n">SubtractDark</span>
<span class="kn">from</span> <span class="nn">crikit.preprocess.subtract_mean</span> <span class="k">import</span> <span class="n">SubtractMeanOverRange</span>
<span class="kn">from</span> <span class="nn">crikit.ui.dialog_kkOptions</span> <span class="k">import</span> <span class="n">DialogKKOptions</span>
<span class="kn">from</span> <span class="nn">crikit.ui.dialog_ploteffect</span> <span class="k">import</span> \
    <span class="n">DialogPlotEffectFuture</span> <span class="k">as</span> <span class="n">_DialogPlotEffect</span>
<span class="kn">from</span> <span class="nn">crikit.ui.dialog_save</span> <span class="k">import</span> <span class="n">DialogSave</span>
<span class="kn">from</span> <span class="nn">crikit.ui.dialog_varstabAnscombeOptions</span> <span class="k">import</span> <span class="n">DialogAnscombeOptions</span>
<span class="kn">from</span> <span class="nn">crikit.ui.qt_CRIkit</span> <span class="k">import</span> <span class="n">Ui_MainWindow</span>
<span class="kn">from</span> <span class="nn">crikit.ui.subui_hdf_load</span> <span class="k">import</span> <span class="n">SubUiHDFLoad</span>
<span class="kn">from</span> <span class="nn">crikit.ui.utils.roi</span> <span class="k">import</span> <span class="n">roimask</span> <span class="k">as</span> <span class="n">_roimask</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_Calibrate</span> <span class="k">import</span> <span class="n">widgetCalibrate</span> <span class="k">as</span> <span class="n">_widgetCalibrate</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_DeTrending</span> <span class="k">import</span> <span class="n">widgetALS</span> <span class="k">as</span> <span class="n">_widgetALS</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_DeTrending</span> <span class="k">import</span> <span class="n">widgetArPLS</span> <span class="k">as</span> <span class="n">_widgetArPLS</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_DeTrending</span> <span class="k">import</span> <span class="n">widgetDeTrending</span> <span class="k">as</span> <span class="n">_widgetDeTrending</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_images</span> <span class="k">import</span> <span class="p">(</span><span class="n">widgetBWImg</span><span class="p">,</span> <span class="n">widgetColorMath</span><span class="p">,</span>
                                     <span class="n">widgetCompositeColor</span><span class="p">,</span> <span class="n">widgetSglColor</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_mergeNRBs</span> <span class="k">import</span> <span class="n">widgetMergeNRBs</span> <span class="k">as</span> <span class="n">_widgetMergeNRBs</span>
<span class="kn">from</span> <span class="nn">crikit.ui.widget_SG</span> <span class="k">import</span> <span class="n">widgetSG</span> <span class="k">as</span> <span class="n">_widgetSG</span>
<span class="kn">from</span> <span class="nn">crikit.utils.breadcrumb</span> <span class="k">import</span> <span class="n">BCPre</span> <span class="k">as</span> <span class="n">_BCPre</span>
<span class="kn">from</span> <span class="nn">crikit.utils.general</span> <span class="k">import</span> <span class="n">find_nearest</span><span class="p">,</span> <span class="n">mean_nd_to_1d</span>
<span class="kn">from</span> <span class="nn">sciplot.sciplotUI</span> <span class="k">import</span> <span class="n">SciPlotUI</span> <span class="k">as</span> <span class="n">_SciPlotUI</span>

<span class="n">_h5py</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span><span class="o">.</span><span class="n">complex_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Re&#39;</span><span class="p">,</span> <span class="s1">&#39;Im&#39;</span><span class="p">)</span>

<span class="n">force_not_sw</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">crikit2_sw</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">__sw_installed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SW package not installed, using standard&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">crikit.ui.dialog_SVD</span> <span class="k">import</span> <span class="n">DialogSVD</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">__sw_installed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">force_not_sw</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SW package installed, but forced off -- using standard&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">crikit.ui.dialog_SVD</span> <span class="k">import</span> <span class="n">DialogSVD</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SW package installed, let</span><span class="se">\&#39;</span><span class="s1">s rock!&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">crikit2_sw.ui.dialog_SVD</span> <span class="k">import</span> <span class="n">DialogSVD</span>


<span class="n">_mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Qt5Agg&#39;</span><span class="p">)</span>
<span class="n">_mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sans-serif&#39;</span>
<span class="n">_mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">jupyter_flag</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">crikit.ui.widget_Jupyter</span> <span class="k">import</span> <span class="n">QJupyterWidget</span>
    <span class="n">jupyter_flag</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No appropriate Jupyter/IPython installation found. Console will not be available&#39;</span><span class="p">)</span>
    <span class="n">jupyter_flag</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">help_index</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> 
                              <span class="s1">&#39;../docs/build/html/index.html&#39;</span><span class="p">))</span>

<span class="k">if</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">help_index</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">help_index</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="CRIkitUI_process"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process">[docs]</a><span class="k">class</span> <span class="nc">CRIkitUI_process</span><span class="p">(</span><span class="n">_QMainWindow</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CRIkitUI_process : CRIkitUI for image (pre-)processing</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    [1] C H Camp Jr, Y J Lee, and M T Cicerone, &quot;Quantitative, Comparable Coherent \</span>
<span class="sd">    Anti-Stokes Raman Scattering (CARS) Spectroscopy: Correcting Errors in Phase \</span>
<span class="sd">    Retrieval,&quot; Journal of Raman Spectroscopy (2016). arXiv:1507.06543.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NUMCOLORS</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Number of single-color windows to auto-generate</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># Generic load/init designer-based GUI</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CRIkitUI_process</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="c1">### EDIT ###</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span> <span class="o">=</span> <span class="n">_BCPre</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>

        <span class="c1"># Overlays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_overlays</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Piecewise NRB&#39;s (not always used)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>

        <span class="c1"># Internal Parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span> <span class="o">=</span> <span class="n">_SciPlotUI</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_MainWindow</span><span class="p">()</span> <span class="c1">### EDIT ###</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>     <span class="c1">### EDIT ###</span>

        <span class="c1"># Match UI Show overlays to attribute of this class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowOverlays</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_overlays</span><span class="p">)</span>


        <span class="c1"># Initialize Intensity image (single frequency B&amp;W)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span> <span class="o">=</span> <span class="n">widgetBWImg</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">figfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkBoxFixed</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditMax</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">maxer</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditMin</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">minner</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sweeperVL</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># ID used for matplotlib to connect to a figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Initialize Single-Color RGB widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NUMCOLORS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widgetSglColor</span><span class="p">(</span><span class="n">figfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>

        <span class="c1"># Split from previous for-loop for compactness of code</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">rgb_img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">):</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">colormap</span> <span class="o">=</span>\
                <span class="n">widgetSglColor</span><span class="o">.</span><span class="n">COLORMAPS</span><span class="p">[</span><span class="n">widgetSglColor</span><span class="o">.</span><span class="n">COLORMAP_ORDER</span><span class="p">[</span><span class="n">count</span><span class="p">]]</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">rgb_img</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">widgetSglColor</span><span class="o">.</span><span class="n">COLORMAP_ORDER</span><span class="p">[</span><span class="n">count</span><span class="p">])</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

            <span class="n">rgb_img</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">rgb_img</span><span class="p">,</span> <span class="s1">&#39;Color &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>

            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonDoMath</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq1</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setOpFreq1</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq2</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setOpFreq2</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq3</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setOpFreq3</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxOperations</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opChange</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq1</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setCondFreq1</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq2</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setCondFreq2</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq3</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setCondFreq3</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondOps</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condOpChange</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondInEquality</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condInEqualityChange</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxInEquality</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxInEqualityChange</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonDoMath</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doMath</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditMax</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditMin</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">gainSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span> <span class="o">=</span> <span class="n">widgetCompositeColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">,</span>
                                                  <span class="n">figfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span> <span class="o">=</span> <span class="n">widgetCompositeColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">,</span>
                                                   <span class="n">figfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="p">,</span> <span class="s1">&#39;Composite Image&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">sweeperVL_2</span><span class="o">.</span><span class="n">insertWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkCompositeUpdate</span><span class="p">)</span>


        <span class="c1"># SIGNALS &amp; SLOTS</span>

        <span class="c1"># Load Data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpenHDFNIST</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileOpenHDFNIST</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadNRB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDark</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadDark</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpenDLMNIST</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileOpenDLMNIST</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRBDLM</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadNRBDLM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDarkDLM</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadDarkDLM</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrbFromROI</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAppend_NRB_from_ROI</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrbFromROI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Left_Side</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadNRB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI_Left_Side</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrbFromROI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Right_Side</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadNRB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI_Right_Side</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrbFromROI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mergeNRBs</span><span class="p">)</span>

        <span class="c1"># Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSettings</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>

        <span class="c1"># Undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doUndo</span><span class="p">)</span>

        <span class="c1"># Close event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">closeEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closeEvent</span>

        <span class="c1"># Subtract DARK-Related</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subDark</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionResidualSubtract</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subResidual</span><span class="p">)</span>


        <span class="c1"># ZERO first column or row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstColumn</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeroFirstColumn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstRow</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeroFirstRow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastColumn</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeroLastColumn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastRow</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeroLastRow</span><span class="p">)</span>

        <span class="c1"># Set frequency WINDOW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionFreqWindow</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqWindow</span><span class="p">)</span>

        <span class="c1"># Calibrate Wavenumber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalibrate</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionResetCalibration</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrationReset</span><span class="p">)</span>

        <span class="c1"># Perform KK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doKK</span><span class="p">)</span>
<span class="c1">#        self.ui.actionKKSpeedTest.triggered.connect(self.testKK)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Variance Stabilize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAnscombe</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anscombe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionInverseAnscombe</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inverseAnscombe</span><span class="p">)</span>

        <span class="c1"># DeNoise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoise</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deNoise</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deNoiseNRB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseDark</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deNoiseDark</span><span class="p">)</span>

        <span class="c1"># Error Correction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errorCorrectPhase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errorCorrectScale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAmpErrorCorrection</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errorCorrectAmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSubtractROI</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtractROIStart</span><span class="p">)</span>

        <span class="c1"># SAVE</span>
<span class="c1">#        self.ui.actionSave.setEnabled(False)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSave</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">)</span>

        <span class="c1"># Plotting spectra-related</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPointSpectrum</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointSpectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionROISpectrum</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roiSpectrum</span><span class="p">)</span>
<span class="c1">#        self.plotter.model.dataDeleted.connect(self.deleteSelection)</span>
<span class="c1">#        self.plotter.model.colorChanged.connect(self.colorChange)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotDarkSpectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotNRBSpectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLeftSideNRBSpect</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotLeftNRBSpectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionRightSideNRBSpect</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotRightNRBSpectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowPlotter</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotter_show</span><span class="p">)</span>

        <span class="c1"># Overlays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">modelLine</span><span class="o">.</span><span class="n">dataDeleted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updateOverlays</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">modelLine</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updateOverlays</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">all_cleared</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deleteOverlays</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowOverlays</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkShowOverlays</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowOverlayLegend</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">)</span>

<span class="c1">#        # Frequency-slider related</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">sliderPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sliderPressed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">sliderReleased</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sliderReleased</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1">#        # Frequency-slider display boxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineEditFreqChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditPix</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineEditPixChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditPix</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">labelFreqPixel</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Help</span>
        <span class="k">if</span> <span class="n">help_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionHelpManual</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">_webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;file:///&#39;</span> <span class="o">+</span> <span class="n">help_index</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionHelpManual</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Jupyter console</span>

        <span class="k">if</span> <span class="n">jupyter_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">jupyterConsole</span> <span class="o">=</span> <span class="n">QJupyterWidget</span><span class="p">(</span><span class="n">customBanner</span><span class="o">=</span><span class="s1">&#39;Welcome to the &#39;</span>
                                                 <span class="s1">&#39;embedded ipython console</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabMain</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jupyterConsole</span><span class="p">,</span> <span class="s1">&#39;Jupyter/IPython Console&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">jupyterConsole</span><span class="o">.</span><span class="n">pushVariables</span><span class="p">({</span><span class="s1">&#39;ui&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span>
                                               <span class="s1">&#39;bcpre&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="p">,</span>
                                               <span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="p">,</span>
                                               <span class="s1">&#39;nrb&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="p">,</span>
                                               <span class="s1">&#39;crikit_data&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabMain</span><span class="o">.</span><span class="n">currentChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabMainChange</span><span class="p">)</span>


        <span class="c1"># Temporary toolbar setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">setToolButtonStyle</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolButtonTextUnderIcon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNIST1</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbarSetting</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNIST2</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbarSetting</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNone</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbarSetting</span><span class="p">)</span>

        <span class="c1"># Default toolbar is NIST Workflow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNIST2</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>

<div class="viewcode-block" id="CRIkitUI_process.plotter_show"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.plotter_show">[docs]</a>    <span class="k">def</span> <span class="nf">plotter_show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.toolbarSetting"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.toolbarSetting">[docs]</a>    <span class="k">def</span> <span class="nf">toolbarSetting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toolbar settings through View menu.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">toolbar_actions</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNone</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNIST2</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNIST1</span><span class="p">]</span>

        <span class="n">sndr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tb</span> <span class="ow">in</span> <span class="n">toolbar_actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sndr</span> <span class="o">==</span> <span class="n">tb</span><span class="p">:</span>
                <span class="n">tb</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tb</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Hide toolbar if None</span>
        <span class="k">if</span> <span class="n">sndr</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNone</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># So far only NIST toolbar setup</span>
        <span class="k">if</span> <span class="n">sndr</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNIST2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNIST2</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addActions</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpenHDFNIST</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSave</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addActions</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPointSpectrum</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionROISpectrum</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addActions</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDark</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addActions</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionResidualSubtract</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionFreqWindow</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAnscombe</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoise</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionInverseAnscombe</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSubtractROI</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalibrate</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAmpErrorCorrection</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">sndr</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNIST1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionToolBarNIST2</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addActions</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionOpenDLMNIST</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSave</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addActions</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPointSpectrum</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionROISpectrum</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addActions</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDarkDLM</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRBDLM</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">toolBar</span><span class="o">.</span><span class="n">addActions</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionResidualSubtract</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionFreqWindow</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAnscombe</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoise</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionInverseAnscombe</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSubtractROI</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalibrate</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAmpErrorCorrection</span><span class="p">])</span></div>

<div class="viewcode-block" id="CRIkitUI_process.save"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">dset_name_suffix</span>
<span class="c1">#        print(&#39;Suffix: {}&#39;.format(suffix))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">DialogSave</span><span class="o">.</span><span class="n">dialogSave</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                        <span class="n">current_filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                        <span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                        <span class="n">current_dataset_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span> <span class="c1"># Save canceled</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_filename</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_dataset_name</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="c1">#                print(&#39;Filename: {}&#39;.format(self.save_filename))</span>
<span class="c1">#                print(&#39;Dataset name: {}&#39;.format(self.save_dataset_name))</span>
<span class="c1">#                print(&#39;Path: {}&#39;.format(self.save_path))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">save_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_dataset_name</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_dataset_name_no_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_dataset_name</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1">#                print(&#39;Group location: {}&#39;.format(self.save_grp))</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">f_out</span> <span class="o">=</span> <span class="n">_h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_filename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
                    <span class="n">loc</span> <span class="o">=</span> <span class="n">f_out</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_grp</span><span class="p">)</span>
                    <span class="n">dset</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dataset_name_no_grp</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                    <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">meta</span>
                    <span class="k">for</span> <span class="n">attr_key</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="n">attr_key</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">attr_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">attr_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">attr_key</span><span class="p">])</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in HSI attributes: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_key</span><span class="p">))</span>

                    <span class="n">bc_attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">attr_dict</span>

                    <span class="k">for</span> <span class="n">attr_key</span> <span class="ow">in</span> <span class="n">bc_attr_dict</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">bc_attr_dict</span><span class="p">[</span><span class="n">attr_key</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">attr_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">attr_key</span><span class="p">,</span> <span class="n">bc_attr_dict</span><span class="p">[</span><span class="n">attr_key</span><span class="p">])</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not create attribute&#39;</span><span class="p">)</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Something went wrong while saving&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved without issues&#39;</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">f_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> -&gt; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_filename</span><span class="p">))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Couldn</span><span class="se">\&#39;</span><span class="s1">t open save dialog&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.tabMainChange"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.tabMainChange">[docs]</a>    <span class="k">def</span> <span class="nf">tabMainChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabMain</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># Jupyter console</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jupyterConsole</span><span class="o">.</span><span class="n">_control</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.closeEvent"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Closing&#39;</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">_QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">closeAllWindows</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">pop_to_last</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">del_flag</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="s1">&#39;.pickle&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in deleting old pickle files&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">del_flag</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">del_flag</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Did not delete pickle file cut list... Something went wrong&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.fileOpenHDFNIST"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.fileOpenHDFNIST">[docs]</a>    <span class="k">def</span> <span class="nf">fileOpenHDFNIST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open and load HDF5 File</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get data and load into CRI_HSI class</span>
        <span class="c1"># This will need to change to accomodate multiple-file selection</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">to_open</span> <span class="o">=</span> <span class="n">SubUiHDFLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;to_open: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_open</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">to_open</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not open file. Corrupt or not appropriate file format.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">Hsi</span><span class="p">()</span>
                <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenSuccess</span><span class="p">(</span><span class="n">success</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.fileOpenDLMNIST"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.fileOpenDLMNIST">[docs]</a>    <span class="k">def</span> <span class="nf">fileOpenDLMNIST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open and load DLM File</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get data and load into CRI_HSI class</span>
        <span class="c1"># This will need to change to accomodate multiple-file selection</span>
        <span class="n">filename_header</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">_QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open Header File&#39;</span><span class="p">,</span>
                                                         <span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="s1">&#39;All Files (*.*)&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">filename_header</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename_header</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
            <span class="n">filename_data</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">_QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open Data File&#39;</span><span class="p">,</span>
                                                           <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                                           <span class="s1">&#39;All Files (*.*)&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">filename_data</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename_data</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename_data</span><span class="p">))[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">::]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span> <span class="o">=</span> <span class="n">filename_header</span>

                <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist_dlm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fileOpenSuccess</span><span class="p">(</span><span class="n">success</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.fileOpenSuccess"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.fileOpenSuccess">[docs]</a>    <span class="k">def</span> <span class="nf">fileOpenSuccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">success</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executed after a file is loaded. Checks success and appropriately</span>
<span class="sd">        activates or deactivates action (buttons)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
            <span class="c1"># FILE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSave</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># EDIT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstColumn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstRow</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastColumn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastRow</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionFreqWindow</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionCalibrate</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionResetCalibration</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># VIEW</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPointSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionROISpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># IMPORT/LOAD</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDark</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDarkDLM</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRBDLM</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># self.ui.actionAppend_NRB_from_ROI.setEnabled(True)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuPiece_wise_NRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># PREPROCESS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionResidualSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAnscombe</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionInverseAnscombe</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoise</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionAmpErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionSubtractROI</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRB_from_ROI</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuVariance_Stabilize</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># ANALYSIS</span>
<span class="c1">#                    self.ui.actionAnalysisToolkit.setEnabled(True)</span>

            <span class="n">is_complex</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_complex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadDark</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstColumn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroFirstRow</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastColumn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionZeroLastRow</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Backup for Undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;Raw&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>

        <span class="c1"># Set frequency slider and associated displays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setSliderPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">sliderPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditPix</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">sliderPosition</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)))</span>
<span class="c1">#</span>
<span class="c1">#</span>
        <span class="c1"># Set BW Class Data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">initData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">pos</span><span class="p">]</span>
<span class="c1">#                self.img_BW.data.grayscaleimage = retr_freq_plane(self.hsi, pos)</span>

        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
            <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

        <span class="c1"># print(&#39;Xlabel: {}&#39;.format(xlabel))</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
            <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
        <span class="c1"># xlabel = r&#39;{} ({})&#39;.format(self.hsi.x_rep.label.strip(), self.hsi.x_rep.units.strip())</span>
        <span class="c1"># ylabel = r&#39;{} ({})&#39;.format(self.hsi.y_rep.label.strip(), self.hsi.y_rep.units.strip())</span>

        <span class="c1"># print(&#39;Ylabel: {}&#39;.format(ylabel))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
<span class="c1">#</span>
        <span class="c1"># Set min/max, fixed, compress, etc buttons to defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkBoxFixed</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkBoxCompress</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkBoxRemOutliers</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1">#                # Plot Grayscale image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createImgBW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="c1">#</span>
<span class="c1">#</span>
        <span class="c1"># RGB images</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span>

        <span class="c1"># Re-initialize RGB images</span>

        <span class="k">for</span> <span class="n">rgb_img</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">:</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">initData</span><span class="p">()</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>

            <span class="c1"># Cute way of setting the colormap to last setting and replotting</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>

            <span class="c1"># Enable Math</span>
            <span class="n">rgb_img</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonDoMath</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Enable mean spectrum from RGB images</span>
            <span class="c1"># Note: if load new file after one has already loaded, need to disconnect</span>
            <span class="c1"># signal then reconnect (or could have ignored, but this is easier)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rgb_img</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonSpectrum</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">rgb_img</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonSpectrum</span><span class="o">.</span><span class="n">pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrumColorImg</span><span class="p">)</span>

            <span class="n">rgb_img</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Set X- and Y- scales, labels, etc for composite color images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.loadDark"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.loadDark">[docs]</a>    <span class="k">def</span> <span class="nf">loadDark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open HDF file and load dark spectrum(a)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">to_open</span> <span class="o">=</span> <span class="n">SubUiHDFLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;To_open: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_open</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pth</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datasets</span> <span class="o">=</span> <span class="n">to_open</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseDark</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dark was the wrong shape&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseDark</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="CRIkitUI_process.loadDarkDLM"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.loadDarkDLM">[docs]</a>    <span class="k">def</span> <span class="nf">loadDarkDLM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open DLM file and load dark spectrum(a)</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">filename</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">_QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open Dark File&#39;</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                                  <span class="s1">&#39;All Files (*.*)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">))[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">::]</span>


            <span class="c1"># Spectra first</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist_dlm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span> <span class="c1"># Maybe Spectrum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
                <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist_dlm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="p">)</span>
<span class="c1">#            print(&#39;Success: {}&#39;.format(success))</span>

            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dark was the wrong shape&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dark</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSubtract</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDarkSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="CRIkitUI_process.loadNRB"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.loadNRB">[docs]</a>    <span class="k">def</span> <span class="nf">loadNRB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open HDF file and load NRB spectrum(a)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="p">:</span>
            <span class="n">nrb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Left_Side</span><span class="p">:</span>
            <span class="n">nrb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Right_Side</span><span class="p">:</span>
            <span class="n">nrb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span>

<span class="c1">#        print(&#39;Sender: {}&#39;.format(sender))</span>
        <span class="n">to_open</span> <span class="o">=</span> <span class="n">SubUiHDFLoad</span><span class="o">.</span><span class="n">getFileDataSets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">to_open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pth</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datasets</span> <span class="o">=</span> <span class="n">to_open</span>

            <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">nrb</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nrb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuCoherent_Raman_Imaging</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Left_Side</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLeftSideNRBSpect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoad_NRB_Right_Side</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionRightSideNRBSpect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRB was the wrong shape&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLoadNRB</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.loadNRBDLM"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.loadNRBDLM">[docs]</a>    <span class="k">def</span> <span class="nf">loadNRBDLM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open DLM file and load NRB spectrum(a)</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">filename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Open NRB File&#39;</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                                   <span class="s1">&#39;All Files (*.*)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">))[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">::]</span>


            <span class="c1"># Spectra first</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist_dlm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span> <span class="c1"># Maybe Spectrum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
                <span class="n">success</span> <span class="o">=</span> <span class="n">io_nist_dlm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_header</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Success: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">success</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRB was the wrong shape&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.mergeNRBs"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.mergeNRBs">[docs]</a>    <span class="k">def</span> <span class="nf">mergeNRBs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interactive merge of the left- and right-side NRB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>
<span class="c1">#            print(&#39;Range: {}&#39;.format(rng))</span>
<span class="c1">#            print(&#39;nrb_left shape&#39;.format(self.nrb_left.shape))</span>


            <span class="n">rand_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetMergeNRBs</span><span class="p">(</span><span class="n">wn_vec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                      <span class="n">nrb_left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">],</span>
                                      <span class="n">nrb_right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">])</span>
            <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">rand_spectra</span><span class="p">,</span>
                                                               <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                               <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRB merge pixel: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pix_switchpt&#39;</span><span class="p">]))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRB merge WN: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;wn_switchpt&#39;</span><span class="p">]))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRB merge scale left side: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scale_left&#39;</span><span class="p">]))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nrb shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

                <span class="n">inst_nrb_merge</span> <span class="o">=</span> <span class="n">_MergeNRBs</span><span class="p">(</span><span class="n">nrb_left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">],</span>
                                            <span class="n">nrb_right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">],</span>
                                            <span class="n">pix</span><span class="o">=</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pix_switchpt&#39;</span><span class="p">],</span>
                                            <span class="n">left_side_scale</span><span class="o">=</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scale_left&#39;</span><span class="p">])</span>
                <span class="n">nrb_merge</span> <span class="o">=</span> <span class="n">inst_nrb_merge</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>

                <span class="c1"># Need 2D because of class Spectra NOT Spectrum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">]</span> <span class="o">=</span> <span class="n">nrb_merge</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuCoherent_Raman_Imaging</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionDeNoiseNRB</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">wn</span><span class="p">,</span> <span class="n">pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pix_switchpt&#39;</span><span class="p">]])</span>

                <span class="c1"># Backup for Undo</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;MergeNRBs&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;pix_switchpt&#39;</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span>
                                     <span class="s1">&#39;wn_switchpt&#39;</span><span class="p">,</span>
                                     <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;wn_switchpt&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;scale_left&#39;</span><span class="p">,</span>
                                     <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scale_left&#39;</span><span class="p">]])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.settings"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.settings">[docs]</a>    <span class="k">def</span> <span class="nf">settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Go to settings tab</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabMain</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabSettings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabMain</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.calibrate"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.calibrate">[docs]</a>    <span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calibrate spectra</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rand_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">rand_spectra</span><span class="p">):</span>
            <span class="n">rand_spectra</span> <span class="o">=</span> <span class="n">rand_spectra</span><span class="o">.</span><span class="n">imag</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetCalibrate</span><span class="p">(</span><span class="n">calib_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span><span class="p">)</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="n">rand_spectra</span><span class="p">,</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#print(&#39;New Calibration Dictionary: {}&#39;.format(winPlotEffect.new_calib_dict))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;new_calib_dict&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>


<div class="viewcode-block" id="CRIkitUI_process.calibrationReset"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.calibrationReset">[docs]</a>    <span class="k">def</span> <span class="nf">calibrationReset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set self.hsi.freqcalib back to self.hsi.freqcaliborig</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">calib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.plotDarkSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.plotDarkSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">plotDarkSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot dark spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">mean_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
                              <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Dark Spectrum&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.plotNRBSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.plotNRBSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">plotNRBSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot NRB spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">mean_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
                              <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean NRB Spectrum&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.plotLeftNRBSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.plotLeftNRBSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">plotLeftNRBSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot Left-Side NRB spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">mean_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
                              <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Left-Side NRB Spectrum&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.plotRightNRBSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.plotRightNRBSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">plotRightNRBSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot NRB spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f_full</span><span class="p">,</span> <span class="n">mean_nd_to_1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
                              <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Right-Side NRB Spectrum&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.pointSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.pointSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">pointSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get spectrum of selected point.</span>

<span class="sd">        Note: This function just sets up the signal-slot connection for the \</span>
<span class="sd">        MPL window. It executes all the way through</span>

<span class="sd">        Action</span>
<span class="sd">        ------</span>
<span class="sd">            Left mouse-click : Select vertex point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span>
                                                   <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pointClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pointSpectrumPlot</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span></div>

<div class="viewcode-block" id="CRIkitUI_process.subtractROIStart"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.subtractROIStart">[docs]</a>    <span class="k">def</span> <span class="nf">subtractROIStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire an average spectrum from a user-selected ROI and subtract.</span>

<span class="sd">        Note: This function just sets up the signal-slot connection for the \</span>
<span class="sd">        MPL window. It executes all the way through</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Updated by _roiClick</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span> <span class="o">=</span> <span class="p">[]</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> 
                                                   <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiSubtract</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span></div>

<div class="viewcode-block" id="CRIkitUI_process._roiSubtract"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._roiSubtract">[docs]</a>    <span class="k">def</span> <span class="nf">_roiSubtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire an average spectrum from a user-selected ROI and subtract.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span> <span class="o">=</span> <span class="n">locs</span>

        <span class="n">x_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">mask</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">_roimask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                              <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)</span>


        <span class="n">mask_hits</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Len(mask) &gt; 0</span>

            <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">spectra</span>
<span class="c1">#            print(&#39;spectrum.shape: {}&#39;.format(spectrum.shape))</span>
<span class="c1">#            print(spectrum)</span>
            <span class="n">spectrum</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="o">-=</span> <span class="n">spectrum</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>
<span class="c1">#            print(&#39;Here&#39;)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;SubtractROI&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectrum&#39;</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>


            <span class="k">del</span> <span class="n">spectrum</span>

        <span class="k">del</span> <span class="n">x_pix</span>
        <span class="k">del</span> <span class="n">y_pix</span></div>

<div class="viewcode-block" id="CRIkitUI_process.nrbFromROI"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.nrbFromROI">[docs]</a>    <span class="k">def</span> <span class="nf">nrbFromROI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire an average spectrum from a user-selected ROI and apply to the \</span>
<span class="sd">        NRB-- either as the new NRB or averaged with the existing (sender- \</span>
<span class="sd">        dependent)</span>

<span class="sd">        Note: This function just sets up the signal-slot connection for the \</span>
<span class="sd">        MPL window. It executes all the way through</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># I found that the objectName is a better way than a reference to the</span>
        <span class="c1"># actual action (e.g., self.ui.action_*) as the reference may change</span>
        <span class="c1"># depending on the call location or how this method is called</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionAppend_NRB_from_ROI&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI_Left_Side&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI_Right_Side&#39;</span><span class="p">)):</span>
            <span class="c1"># Updated by _roiClick</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">#            print(&#39;Sender: {}&#39;.format(sender))</span>
<span class="c1">#            print(&#39;Sender is actionNRB_from_ROI: {}&#39;.format(sender == self.ui.actionNRB_from_ROI))</span>

            <span class="c1"># Need to send sender as the text name as the actual object</span>
            <span class="c1"># will change</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> 
                                                       <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiNRB</span><span class="p">,</span> <span class="n">sender</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unknown action send to nrbFromROI&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process._roiNRB"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._roiNRB">[docs]</a>    <span class="k">def</span> <span class="nf">_roiNRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire an average spectrum from a user-selected ROI and subtract.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Sender was sent as a text reference to the actual sender</span>
        <span class="c1"># the pass of sender put it in a tuple; thus the [0]</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="n">sender</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">#        print(&#39;Sender: {}&#39;.format(sender))</span>
<span class="c1">#        print(&#39;Sender is actionNRB_from_ROI: {}&#39;.format(sender == self.ui.actionNRB_from_ROI))</span>
<span class="c1">#        print(&#39;Sender is \&#39;actionNRB_from_ROI\&#39;: {}&#39;.format(sender == &#39;actionNRB_from_ROI&#39;))</span>

        <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span> <span class="o">=</span> <span class="n">locs</span>

        <span class="n">x_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">mask</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">_roimask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                              <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)</span>


        <span class="n">mask_hits</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Len(mask) &gt; 0</span>
            <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">[</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">spectra</span>

            <span class="n">spectrum</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spectrum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKKSpeedTest</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">menuCoherent_Raman_Imaging</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionAppend_NRB_from_ROI&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spectrum</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">spectrum</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionKramersKronig</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionNRBSpectrum</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI_Left_Side&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spectrum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionLeftSideNRBSpect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="s1">&#39;actionNRB_from_ROI_Right_Side&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">spectrum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionRightSideNRBSpect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionMergeNRBs</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unknown action sent to _roiNRB&#39;</span><span class="p">)</span>

            <span class="k">del</span> <span class="n">spectrum</span>

        <span class="k">del</span> <span class="n">x_pix</span>
        <span class="k">del</span> <span class="n">y_pix</span></div>

<div class="viewcode-block" id="CRIkitUI_process.roiSpectrum"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.roiSpectrum">[docs]</a>    <span class="k">def</span> <span class="nf">roiSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot spectrum over selected region-of-interest (ROI).</span>

<span class="sd">        Note: This function just sets up the signal-slot connection for the \</span>
<span class="sd">        MPL window. It executes all the way through</span>

<span class="sd">        Action</span>
<span class="sd">        ------</span>
<span class="sd">            Left mouse-click : Select vertex point</span>
<span class="sd">            Right mouse-click : Close polygon</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Updated by _roiClick</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span> <span class="o">=</span> <span class="p">[]</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span>
                                                   <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roiSpectrumPlot</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CrossCursor</span><span class="p">))</span></div>

<div class="viewcode-block" id="CRIkitUI_process._pointClick"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._pointClick">[docs]</a>    <span class="k">def</span> <span class="nf">_pointClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">pass_fcn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture single mouse click location in MPL window.</span>

<span class="sd">        After this function completes, it sends the data (x_pt, y_pt) on to \</span>
<span class="sd">        the pass_fcn function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
                    <span class="c1">#self.tempverts += [[event.xdata, event.ydata]]</span>
                <span class="n">x_loc</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
                <span class="n">y_loc</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>

                <span class="c1"># Send on to a function that will use the collected data</span>
                <span class="n">pass_fcn</span><span class="p">((</span><span class="n">x_loc</span><span class="p">,</span> <span class="n">y_loc</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Clicked out-of-bounds</span>
                <span class="k">pass</span>
<span class="c1">#                print(&#39;Clicked out-of-bounds&#39;)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Right-or-middle clicked; thus, cancel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CRIkitUI_process._pointSpectrumPlot"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._pointSpectrumPlot">[docs]</a>    <span class="k">def</span> <span class="nf">_pointSpectrumPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a plot (in plotter) of a point spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c1">#        try:</span>
        <span class="n">x_loc</span><span class="p">,</span> <span class="n">y_loc</span> <span class="o">=</span> <span class="n">locs</span>
        <span class="n">x_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x_loc</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y_loc</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">#        self.selectiondata.append_selection([x_pix],[y_pix],[x_loc],[y_loc])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>

        <span class="n">plot_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">n_lines</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Point &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">plot_num</span><span class="p">)</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_loc</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_loc</span><span class="p">,</span> <span class="s1">&#39;x_pix&#39;</span><span class="p">:</span> <span class="n">x_pix</span><span class="p">,</span> <span class="s1">&#39;y_pix&#39;</span><span class="p">:</span> <span class="n">y_pix</span><span class="p">,</span>
                <span class="s1">&#39;overlay&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">[</span><span class="n">y_pix</span><span class="p">,</span> <span class="n">x_pix</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span>
                          <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateOverlays</span><span class="p">()</span></div>
<span class="c1">#        self.plotter.raise_()</span>

<div class="viewcode-block" id="CRIkitUI_process._roiSpectrumPlot"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._roiSpectrumPlot">[docs]</a>    <span class="k">def</span> <span class="nf">_roiSpectrumPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a plot (in plotter) of the mean spectrum over a region</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span> <span class="o">=</span> <span class="n">locs</span>

        <span class="n">x_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_pix</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1">#        self.selectiondata.append_selection(x_pix, y_pix, x_loc_list, y_loc_list)</span>
        <span class="c1">#self.img_BW.mpl.mpl_disconnect(self.cid)</span>

        <span class="n">mask</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">_roimask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                              <span class="n">x_loc_list</span><span class="p">,</span> <span class="n">y_loc_list</span><span class="p">)</span>


        <span class="n">mask_hits</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Len(mask) &gt; 0</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

            <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">[</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">stddev</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span>

            <span class="n">plot_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">n_lines</span>

            <span class="n">label_plot</span> <span class="o">=</span> <span class="s1">&#39;ROI </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_num</span><span class="p">,</span> <span class="n">mask_hits</span><span class="p">)</span>
            <span class="n">label_std</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\pm$1 Std. Dev. ROI </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_num</span><span class="p">,</span> <span class="n">mask_hits</span><span class="p">)</span>

            <span class="c1"># Plot line</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_loc_list</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_loc_list</span><span class="p">,</span> <span class="s1">&#39;x_pix&#39;</span><span class="p">:</span> <span class="n">x_pix</span><span class="p">,</span>
                    <span class="s1">&#39;y_pix&#39;</span><span class="p">:</span> <span class="n">y_pix</span><span class="p">,</span> <span class="s1">&#39;overlay&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_plot</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>

            <span class="c1"># Check color of line b/c uses color cycler-- for fill_b/w</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">list_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>


            <span class="c1"># Alternative</span>
            <span class="c1">#color = self.plotter.modelLine._model_data[-1][&#39;color&#39;]</span>

            <span class="c1"># Plot +-1 std. dev.</span>
            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">-</span><span class="n">stddev</span><span class="p">,</span>
                                          <span class="n">spectrum</span><span class="o">+</span><span class="n">stddev</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="n">label_std</span><span class="p">,</span>
                                          <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>

            <span class="k">del</span> <span class="n">spectrum</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateOverlays</span><span class="p">()</span>


        <span class="k">del</span> <span class="n">x_pix</span>
        <span class="k">del</span> <span class="n">y_pix</span></div>

<div class="viewcode-block" id="CRIkitUI_process._roiClick"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process._roiClick">[docs]</a>    <span class="k">def</span> <span class="nf">_roiClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">pass_fcn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture region-of-interest mouse click locations in MPL window.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>

                <span class="n">getx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
                <span class="n">gety</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">,</span>
                                            <span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">markeredgecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                                            <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">getx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">gety</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span>
                                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                                            <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                            <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                            <span class="n">markeredgecolor</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">getx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">gety</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Insure at least 1 vertex</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="c1"># Pass on roi data</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
                    <span class="n">pass_fcn</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pass_fcn</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span><span class="p">),</span> <span class="n">args</span><span class="p">)</span>

            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_loc_list</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_loc_list</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">_QCursor</span><span class="p">(</span><span class="n">_QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ArrowCursor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>


<div class="viewcode-block" id="CRIkitUI_process.freqWindow"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.freqWindow">[docs]</a>    <span class="k">def</span> <span class="nf">freqWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Limit the frequency window displayed and analyzed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">_QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Frequency Window&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;Range Tuple (cm-1): &#39;</span><span class="p">,</span>
                                         <span class="n">text</span><span class="o">=</span><span class="s1">&#39;(500, 3400)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">text_str_list</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">freqwin</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">text_str_list</span><span class="p">]</span>
            <span class="n">freqwin</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_list_freq</span> <span class="o">=</span> <span class="n">freqwin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>


<div class="viewcode-block" id="CRIkitUI_process.lineEditFreqChanged"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.lineEditFreqChanged">[docs]</a>    <span class="k">def</span> <span class="nf">lineEditFreqChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Frequency manually entered in frequency-slider-display</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">freq_in</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="n">freq_in</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_list_pix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_list_pix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setSliderPosition</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.lineEditPixChanged"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.lineEditPixChanged">[docs]</a>    <span class="k">def</span> <span class="nf">lineEditPixChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Frequency in pixel units manually entered in frequency-slider-display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditPix</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setSliderPosition</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.zeroFirstColumn"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.zeroFirstColumn">[docs]</a>    <span class="k">def</span> <span class="nf">zeroFirstColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zero first non-all-zero column. (Rather than crop)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zc</span> <span class="o">=</span> <span class="n">_ZeroColumn</span><span class="p">(</span><span class="n">first_or_last</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Adjust mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_mask</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="o">.</span><span class="n">zero_col</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.zeroFirstRow"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.zeroFirstRow">[docs]</a>    <span class="k">def</span> <span class="nf">zeroFirstRow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zero first non-all-zero row. (Rather than crop)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zr</span> <span class="o">=</span> <span class="n">_ZeroRow</span><span class="p">(</span><span class="n">first_or_last</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Adjust mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_mask</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zr</span><span class="o">.</span><span class="n">zero_row</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.zeroLastColumn"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.zeroLastColumn">[docs]</a>    <span class="k">def</span> <span class="nf">zeroLastColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zero first non-all-zero column. (Rather than crop)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zc</span> <span class="o">=</span> <span class="n">_ZeroColumn</span><span class="p">(</span><span class="n">first_or_last</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Adjust mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_mask</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="o">.</span><span class="n">zero_col</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.zeroLastRow"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.zeroLastRow">[docs]</a>    <span class="k">def</span> <span class="nf">zeroLastRow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zero first non-all-zero row. (Rather than crop)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zr</span> <span class="o">=</span> <span class="n">_ZeroRow</span><span class="p">(</span><span class="n">first_or_last</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Adjust mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">_mask</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zr</span><span class="o">.</span><span class="n">zero_row</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.opChange"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.opChange">[docs]</a>    <span class="k">def</span> <span class="nf">opChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Math operation performed on single-color images changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxOperations</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">currentop</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.condOpChange"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.condOpChange">[docs]</a>    <span class="k">def</span> <span class="nf">condOpChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conditional math operation performed on single-color images changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondOps</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condoperation</span> <span class="o">=</span> <span class="n">currentop</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.condInEqualityChange"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.condInEqualityChange">[docs]</a>    <span class="k">def</span> <span class="nf">condInEqualityChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conditional inequality changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondInEquality</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">inequality</span> <span class="o">=</span> <span class="n">currentop</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.spinBoxInEqualityChange"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.spinBoxInEqualityChange">[docs]</a>    <span class="k">def</span> <span class="nf">spinBoxInEqualityChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conditional inequality value changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">inequalityval</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxInEquality</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.doKK"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.doKK">[docs]</a>    <span class="k">def</span> <span class="nf">doKK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pop-up Kramers-Kronig parameter entry dialog and perform</span>
<span class="sd">        the Kramers-Kronig phase retrieval algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rand_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                 <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">nrb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># Range of pixels to perform-over</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">DialogKKOptions</span><span class="o">.</span><span class="n">dialogKKOptions</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                    <span class="n">nrb</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span>
                                                    <span class="n">rand_spectra</span><span class="p">],</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cars_amp_offset</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;cars_amp&#39;</span><span class="p">]</span>
            <span class="n">nrb_amp_offset</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;nrb_amp&#39;</span><span class="p">]</span>
            <span class="n">phase_offset</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;phase_offset&#39;</span><span class="p">]</span>
            <span class="n">norm_to_nrb</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;norm_to_nrb&#39;</span><span class="p">]</span>
            <span class="n">pad_factor</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;pad_factor&#39;</span><span class="p">]</span>

            <span class="n">kk</span> <span class="o">=</span> <span class="n">KramersKronig</span><span class="p">(</span><span class="n">cars_amp_offset</span><span class="o">=</span><span class="n">cars_amp_offset</span><span class="p">,</span>
                               <span class="n">nrb_amp_offset</span><span class="o">=</span><span class="n">nrb_amp_offset</span><span class="p">,</span>
                               <span class="n">phase_offset</span><span class="o">=</span><span class="n">phase_offset</span><span class="p">,</span> <span class="n">norm_to_nrb</span><span class="o">=</span><span class="n">norm_to_nrb</span><span class="p">,</span>
                               <span class="n">pad_factor</span><span class="o">=</span><span class="n">pad_factor</span><span class="p">,</span>
                               <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">kk</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionPhaseErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionScaleErrorCorrection</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;KK&#39;</span><span class="p">,</span> <span class="s1">&#39;CARSAmp&#39;</span><span class="p">,</span> <span class="n">cars_amp_offset</span><span class="p">,</span> <span class="s1">&#39;NRBAmp&#39;</span><span class="p">,</span>
                                 <span class="n">nrb_amp_offset</span><span class="p">,</span> <span class="s1">&#39;Phase&#39;</span><span class="p">,</span> <span class="n">phase_offset</span><span class="p">,</span>
                                 <span class="s1">&#39;Norm&#39;</span><span class="p">,</span> <span class="n">norm_to_nrb</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span></div>
<span class="c1">#</span>

<div class="viewcode-block" id="CRIkitUI_process.deNoiseNRB"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.deNoiseNRB">[docs]</a>    <span class="k">def</span> <span class="nf">deNoiseNRB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Denoise NRB with Savitky-Golay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Range of pixels to perform-over</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetSG</span><span class="p">(</span><span class="n">window_length</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">],</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">win_size</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;polyorder&#39;</span><span class="p">]</span>

            <span class="n">nrb_denoise</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="n">nrb_denoise</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span> <span class="o">=</span> <span class="n">_sg</span><span class="p">(</span><span class="n">nrb_denoise</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span> <span class="n">win_size</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">nrb_denoise</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;DenoiseNrbSG&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;Win_size&#39;</span><span class="p">,</span> <span class="n">win_size</span><span class="p">,</span>
                                 <span class="s1">&#39;Order&#39;</span><span class="p">,</span> <span class="n">order</span><span class="p">])</span>

<span class="c1">#            if self.ui.actionUndo_Backup_Enabled.isChecked():</span>
<span class="c1">#                try:</span>
<span class="c1">#                    _BCPre.backup_pickle(self.hsi, self.bcpre.id_list[-1])</span>
<span class="c1">#                except:</span>
<span class="c1">#                    print(&#39;Error in pickle backup (Undo functionality)&#39;)</span>
<span class="c1">#                else:</span>
<span class="c1">#                    self.bcpre.backed_up()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.deNoiseDark"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.deNoiseDark">[docs]</a>    <span class="k">def</span> <span class="nf">deNoiseDark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Denoise Dark with Savitky-Golay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Range of pixels to perform-over</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetSG</span><span class="p">(</span><span class="n">window_length</span><span class="o">=</span><span class="mi">201</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">rng</span><span class="p">],</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">win_size</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;polyorder&#39;</span><span class="p">]</span>

            <span class="n">dark_denoise</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="n">dark_denoise</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span> <span class="o">=</span> <span class="n">_sg</span><span class="p">(</span><span class="n">dark_denoise</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">],</span> <span class="n">win_size</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dark_denoise</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;DenoiseDarkSG&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;Win_size&#39;</span><span class="p">,</span> <span class="n">win_size</span><span class="p">,</span>
                                 <span class="s1">&#39;Order&#39;</span><span class="p">,</span> <span class="n">order</span><span class="p">])</span>

<span class="c1">#            if self.ui.actionUndo_Backup_Enabled.isChecked():</span>
<span class="c1">#                try:</span>
<span class="c1">#                    _BCPre.backup_pickle(self.hsi, self.bcpre.id_list[-1])</span>
<span class="c1">#                except:</span>
<span class="c1">#                    print(&#39;Error in pickle backup (Undo functionality)&#39;)</span>
<span class="c1">#                else:</span>
<span class="c1">#                    self.bcpre.backed_up()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.deNoise"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.deNoise">[docs]</a>    <span class="k">def</span> <span class="nf">deNoise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SVD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Range of pixels to perform-over</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>
<span class="c1">#        print(&#39;Range: {}&#39;.format(rng))</span>
        <span class="c1"># SVD Decompose</span>
        <span class="n">svd_decompose</span> <span class="o">=</span> <span class="n">SVDDecompose</span><span class="p">(</span><span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
        <span class="n">UsVh</span> <span class="o">=</span> <span class="n">svd_decompose</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Class method route</span>
        <span class="k">if</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Note: .main in dialog_AbstractFactorization</span>
            <span class="n">svs</span> <span class="o">=</span> <span class="n">DialogSVD</span><span class="o">.</span><span class="n">dialogSVD</span><span class="p">(</span><span class="n">UsVh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                                      <span class="n">img_all</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
                                      <span class="n">spect_all</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
                                      <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">svs</span> <span class="o">=</span> <span class="n">DialogSVD</span><span class="o">.</span><span class="n">dialogSVD</span><span class="p">(</span><span class="n">UsVh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                      <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                                      <span class="n">img_all</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
                                      <span class="n">spect_all</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rng</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
                                      <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SV</span><span class="se">\&#39;</span><span class="s1">s:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svs</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">svs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">svd_recompose</span> <span class="o">=</span> <span class="n">SVDRecompose</span><span class="p">(</span><span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">svd_recompose</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">UsVh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">UsVh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">UsVh</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="n">svs</span><span class="o">=</span><span class="n">svs</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;SVD&#39;</span><span class="p">,</span> <span class="s1">&#39;SVs&#39;</span><span class="p">,</span> <span class="n">svs</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>


<div class="viewcode-block" id="CRIkitUI_process.errorCorrectPhase"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.errorCorrectPhase">[docs]</a>    <span class="k">def</span> <span class="nf">errorCorrectPhase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error Correction: Phase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rand_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                 <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">rand_spectra</span><span class="p">):</span>
            <span class="n">rand_spectra</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">rand_spectra</span><span class="p">)</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetALS</span><span class="p">()</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="n">rand_spectra</span><span class="p">,</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">asym_param</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;asym_param&#39;</span><span class="p">]</span>
            <span class="n">smoothness_param</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;smoothness_param&#39;</span><span class="p">]</span>
            <span class="n">redux_factor</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;redux&#39;</span><span class="p">]</span>
            <span class="n">fix_end_points</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;fix_end_points&#39;</span><span class="p">]</span>
            <span class="n">max_iter</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span>
            <span class="n">min_diff</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;min_diff&#39;</span><span class="p">]</span>

            <span class="n">phase_err_correct_als</span> <span class="o">=</span> <span class="n">_PhaseErrCorrectALS</span><span class="p">(</span><span class="n">smoothness_param</span><span class="o">=</span><span class="n">smoothness_param</span><span class="p">,</span>
                                                        <span class="n">asym_param</span><span class="o">=</span><span class="n">asym_param</span><span class="p">,</span>
                                                        <span class="n">redux</span><span class="o">=</span><span class="n">redux_factor</span><span class="p">,</span>
                                                        <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                        <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span>
                                                        <span class="n">fix_end_points</span><span class="o">=</span><span class="n">fix_end_points</span><span class="p">,</span>
                                                        <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span>
                                                        <span class="n">min_diff</span><span class="o">=</span><span class="n">min_diff</span><span class="p">,</span>
                                                        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">phase_err_correct_als</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>

            <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">asym_param</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;PhaseErrorCorrectALS&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;smoothness_param&#39;</span><span class="p">,</span> <span class="n">smoothness_param</span><span class="p">,</span>
                                     <span class="s1">&#39;asym_param&#39;</span><span class="p">,</span> <span class="n">asym_param</span><span class="p">,</span>
                                     <span class="s1">&#39;redux&#39;</span><span class="p">,</span> <span class="n">redux_factor</span><span class="p">,</span>
                                     <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                     <span class="s1">&#39;fix_end_points&#39;</span><span class="p">,</span> <span class="n">fix_end_points</span><span class="p">,</span>
                                     <span class="s1">&#39;max_iter&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span>
                                     <span class="s1">&#39;min_diff&#39;</span><span class="p">,</span> <span class="n">min_diff</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;PhaseErrorCorrectALS&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;smoothness_param&#39;</span><span class="p">,</span> <span class="n">smoothness_param</span><span class="p">,</span>
                                     <span class="s1">&#39;asym_param_start&#39;</span><span class="p">,</span>
                                     <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;asym_param_start&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;asym_param_end&#39;</span><span class="p">,</span>
                                     <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;asym_param_end&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;redux&#39;</span><span class="p">,</span> <span class="n">redux_factor</span><span class="p">,</span>
                                     <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                     <span class="s1">&#39;fix_end_points&#39;</span><span class="p">,</span> <span class="n">fix_end_points</span><span class="p">,</span>
                                     <span class="s1">&#39;max_iter&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span>
                                     <span class="s1">&#39;min_diff&#39;</span><span class="p">,</span> <span class="n">min_diff</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.errorCorrectScale"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.errorCorrectScale">[docs]</a>    <span class="k">def</span> <span class="nf">errorCorrectScale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error Correction: Scale</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rand_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                 <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">rand_spectra</span><span class="p">):</span>
            <span class="n">rand_spectra</span> <span class="o">=</span> <span class="n">rand_spectra</span><span class="o">.</span><span class="n">real</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetSG</span><span class="p">(</span><span class="n">window_length</span><span class="o">=</span><span class="mi">601</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="n">rand_spectra</span><span class="p">,</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">win_size</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;polyorder&#39;</span><span class="p">]</span>

            <span class="n">scale_err_correct_sg</span> <span class="o">=</span> <span class="n">_ScaleErrCorrectSG</span><span class="p">(</span><span class="n">win_size</span><span class="o">=</span><span class="n">win_size</span><span class="p">,</span>
                                                      <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
                                                      <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">scale_err_correct_sg</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;ScaleErrorCorrectSG&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;win_size&#39;</span><span class="p">,</span> <span class="n">win_size</span><span class="p">,</span>
                                 <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="n">order</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.errorCorrectAmp"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.errorCorrectAmp">[docs]</a>    <span class="k">def</span> <span class="nf">errorCorrectAmp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error Correction: Amp aka Baseline Detrending</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        If data is complex, amplitude detrending occurs on and only on the \</span>
<span class="sd">        imaginary portion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rand_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">get_rand_spectra</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_sz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                 <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">rand_spectra</span><span class="p">):</span>
            <span class="n">rand_spectra</span> <span class="o">=</span> <span class="n">rand_spectra</span><span class="o">.</span><span class="n">imag</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

        <span class="n">plugin</span> <span class="o">=</span> <span class="n">_widgetALS</span><span class="p">()</span>
        <span class="n">winPlotEffect</span> <span class="o">=</span> <span class="n">_DialogPlotEffect</span><span class="o">.</span><span class="n">dialogPlotEffect</span><span class="p">(</span><span class="n">rand_spectra</span><span class="p">,</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
                                                           <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span>
                                                           <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">winPlotEffect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">asym_param</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;asym_param&#39;</span><span class="p">]</span>
            <span class="n">smoothness_param</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;smoothness_param&#39;</span><span class="p">]</span>
            <span class="n">redux_factor</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;redux&#39;</span><span class="p">]</span>
            <span class="n">fix_end_points</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;fix_end_points&#39;</span><span class="p">]</span>
            <span class="n">max_iter</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span>
            <span class="n">min_diff</span> <span class="o">=</span> <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;min_diff&#39;</span><span class="p">]</span>


            <span class="n">baseline_detrend</span> <span class="o">=</span> <span class="n">_SubtractBaselineALS</span><span class="p">(</span><span class="n">smoothness_param</span><span class="o">=</span><span class="n">smoothness_param</span><span class="p">,</span>
                                                    <span class="n">asym_param</span><span class="o">=</span><span class="n">asym_param</span><span class="p">,</span>
                                                    <span class="n">redux</span><span class="o">=</span><span class="n">redux_factor</span><span class="p">,</span>
                                                    <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                    <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span>
                                                    <span class="n">fix_end_points</span><span class="o">=</span><span class="n">fix_end_points</span><span class="p">,</span>
                                                    <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span>
                                                    <span class="n">min_diff</span><span class="o">=</span><span class="n">min_diff</span><span class="p">,</span>
                                                    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">baseline_detrend</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">asym_param</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;AmpErrorCorrectALS&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;smoothness_param&#39;</span><span class="p">,</span> <span class="n">smoothness_param</span><span class="p">,</span>
                                     <span class="s1">&#39;asym_param&#39;</span><span class="p">,</span> <span class="n">asym_param</span><span class="p">,</span>
                                     <span class="s1">&#39;redux&#39;</span><span class="p">,</span> <span class="n">redux_factor</span><span class="p">,</span>
                                     <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                     <span class="s1">&#39;fix_end_points&#39;</span><span class="p">,</span> <span class="n">fix_end_points</span><span class="p">,</span>
                                     <span class="s1">&#39;max_iter&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span>
                                     <span class="s1">&#39;min_diff&#39;</span><span class="p">,</span> <span class="n">min_diff</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;AmpErrorCorrectALS&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;smoothness_param&#39;</span><span class="p">,</span> <span class="n">smoothness_param</span><span class="p">,</span>
                                     <span class="s1">&#39;asym_param_start&#39;</span><span class="p">,</span>
                                     <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;asym_param_start&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;asym_param_end&#39;</span><span class="p">,</span>
                                     <span class="n">winPlotEffect</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;asym_param_end&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;redux&#39;</span><span class="p">,</span> <span class="n">redux_factor</span><span class="p">,</span>
                                     <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                     <span class="s1">&#39;fix_end_points&#39;</span><span class="p">,</span> <span class="n">fix_end_points</span><span class="p">,</span>
                                     <span class="s1">&#39;max_iter&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span>
                                     <span class="s1">&#39;min_diff&#39;</span><span class="p">,</span> <span class="n">min_diff</span><span class="p">])</span>


            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.doUndo"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.doUndo">[docs]</a>    <span class="k">def</span> <span class="nf">doUndo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Undo last operation back to last backup point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">pop_to_last</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span> <span class="o">=</span> <span class="n">_BCPre</span><span class="o">.</span><span class="n">load_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">del_flag</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="s1">&#39;.pickle&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in deleting old pickle files&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">del_flag</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">del_flag</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">cut_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Did not delete pickle file cut list... Something went wrong&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>


<div class="viewcode-block" id="CRIkitUI_process.subDark"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.subDark">[docs]</a>    <span class="k">def</span> <span class="nf">subDark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subtract loaded dark spectrum from HSI data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nrbloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">nrbloaded_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">nrbloaded_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">darkloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">darkloaded</span><span class="p">:</span>
                <span class="c1"># Instantiate SubtractDark</span>
                <span class="n">sub_dark</span> <span class="o">=</span> <span class="n">SubtractDark</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dark</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Dark Spectrum from Image?&#39;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm dark subtract from image&#39;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                    <span class="n">sub_dark</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Dark Spectrum from NRB Spectrum(a)?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm dark subtract from NRB spectrum(a)&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_dark</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded_left</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Dark Spectrum from Left-Side NRB Spectrum(a)?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm dark subtract from Left-Side NRB spectrum(a)&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_dark</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded_right</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Dark Spectrum from Right-Side NRB Spectrum(a)?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm dark subtract from Right-Side NRB spectrum(a)&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_dark</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>


                <span class="c1"># Backup for Undo</span>
                <span class="k">if</span> <span class="n">darkloaded</span> <span class="ow">or</span> <span class="n">nrbloaded</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;SubDark&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Dark spectrum not loaded.&#39;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Image data not loaded. Cannot subtract dark spectrum.&#39;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.subResidual"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.subResidual">[docs]</a>    <span class="k">def</span> <span class="nf">subResidual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subtract a linear residual over range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nrbloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">nrbloaded_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">nrbloaded_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">imgloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">nrbloaded</span> <span class="ow">or</span> <span class="n">imgloaded</span><span class="p">:</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">_QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Frequency Window&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;Range Tuple (cm-1): &#39;</span><span class="p">,</span>
                                             <span class="n">text</span><span class="o">=</span><span class="s1">&#39;(-1500, -500)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="n">text_str_list</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">freqwin</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">text_str_list</span><span class="p">]</span>
                <span class="n">freqwin</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

                <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="n">freqwin</span><span class="p">)</span>
                <span class="n">sub_residual</span> <span class="o">=</span> <span class="n">SubtractMeanOverRange</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">imgloaded</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Residual Dark Spectrum from Image?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm residual subtraction from Image&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out_img</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out_img</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_residual</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Residual Dark Spectrum from NRB?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm residual subtraction from NRB&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_residual</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded_left</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Residual Dark Spectrum from Left-Side NRB?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm residual subtraction from Left-Side NRB&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_residual</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_left</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">nrbloaded_right</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Subtract Residual Dark Spectrum from Right-Side NRB?&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Confirm residual subtraction from Right-Side NRB&#39;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                        <span class="n">sub_residual</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrb_right</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

                <span class="c1"># Backup for Undo</span>
                <span class="k">if</span> <span class="n">out_img</span> <span class="o">==</span> <span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;SubResidual&#39;</span><span class="p">,</span><span class="s1">&#39;RangeStart&#39;</span><span class="p">,</span>
                                         <span class="n">freqwin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;RangeEnd&#39;</span><span class="p">,</span>
                                         <span class="n">freqwin</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Image or NRB data need be loaded.&#39;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">_QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.anscombe"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.anscombe">[docs]</a>    <span class="k">def</span> <span class="nf">anscombe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performance Anscombe transformation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">DialogAnscombeOptions</span><span class="o">.</span><span class="n">dialogAnscombeOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

            <span class="n">ansc</span> <span class="o">=</span> <span class="n">_Anscombe</span><span class="p">(</span><span class="n">gauss_std</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span> <span class="n">gauss_mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                             <span class="n">poisson_multi</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">],</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">ansc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;Anscombe&#39;</span><span class="p">,</span><span class="s1">&#39;Gauss_mean&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                                 <span class="s1">&#39;Gauss_std&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;Poisson_multi&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.inverseAnscombe"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.inverseAnscombe">[docs]</a>    <span class="k">def</span> <span class="nf">inverseAnscombe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performance an Inverse Anscombe transformation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">DialogAnscombeOptions</span><span class="o">.</span><span class="n">dialogAnscombeOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">DialogAnscombeOptions</span><span class="o">.</span><span class="n">dialogAnscombeOptions</span><span class="p">(</span><span class="n">stddev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span>
                                                              <span class="n">gain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_anscombe_params</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">],</span>
                                                              <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span>

            <span class="n">iansc</span> <span class="o">=</span> <span class="n">_AnscombeInverse</span><span class="p">(</span><span class="n">gauss_std</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span> <span class="n">gauss_mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                     <span class="n">poisson_multi</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">],</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">iansc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Backup for Undo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">add_step</span><span class="p">([</span><span class="s1">&#39;InvAnscombe&#39;</span><span class="p">,</span><span class="s1">&#39;Gauss_mean&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                                 <span class="s1">&#39;Gauss_std&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;Poisson_multi&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo_Backup_Enabled</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_BCPre</span><span class="o">.</span><span class="n">backup_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in pickle backup (Undo functionality)&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_up</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.doMath"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.doMath">[docs]</a>    <span class="k">def</span> <span class="nf">doMath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform selected math operation on single-color imagery.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Which RGB image is it</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="c1"># Which operation is selected</span>
        <span class="n">operation_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondOps</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">operation_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondOps</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>


        <span class="k">if</span> <span class="n">operation_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_freq_needed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_freq_needed</span> <span class="o">=</span> <span class="n">widgetColorMath</span><span class="o">.</span><span class="n">OPERATION_FREQ_COUNT</span><span class="p">[</span><span class="n">operation_index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Check conditional frequencies are set</span>
        <span class="n">cond_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Conditional frequency LOCATION 1</span>
            <span class="n">condloc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">cond_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Conditional frequency LOCATIONS</span>
            <span class="n">condloc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span><span class="p">)</span>
            <span class="n">condloc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq2</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">cond_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Conditional frequency LOCATIONS</span>
            <span class="n">condloc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span><span class="p">)</span>
            <span class="n">condloc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq2</span><span class="p">)</span>
            <span class="n">condloc3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq3</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">cond_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cond_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">cond_set</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondOps</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Mask</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">):</span>  <span class="c1"># Return just a plane</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeak</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                     <span class="n">condloc1</span><span class="p">)</span>


            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>  <span class="c1"># Addition</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakAdd</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                        <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>  <span class="c1"># Subtraction</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMinus</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                          <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>  <span class="c1"># Multiplication</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMultiply</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                             <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="c1"># Division</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakDivide</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                           <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;SUM&#39;</span><span class="p">:</span>  <span class="c1"># Summation over range</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakSummation</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                              <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;Peak b/w troughs&#39;</span><span class="p">:</span>  <span class="c1"># Peak between troughs</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakBWTroughs</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                              <span class="n">condloc1</span><span class="p">,</span> <span class="n">condloc2</span><span class="p">,</span> <span class="n">condloc3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">cond_set</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">inequality_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxCondInEquality</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="n">inequality_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxInEquality</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">inequality_text</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">&lt;</span> <span class="n">inequality_val</span>
            <span class="k">elif</span> <span class="n">inequality_text</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">&gt;</span> <span class="n">inequality_val</span>
            <span class="k">elif</span> <span class="n">inequality_text</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">==</span> <span class="n">inequality_val</span>
            <span class="k">elif</span> <span class="n">inequality_text</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">&gt;=</span> <span class="n">inequality_val</span>
            <span class="k">elif</span> <span class="n">inequality_text</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">&lt;=</span> <span class="n">inequality_val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inequality type error... setting to 1&#39;</span><span class="p">)</span>
                <span class="n">Mask</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Check frequencies are set</span>
        <span class="n">operation_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxOperations</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">operation_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">comboBoxOperations</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">num_freq_needed</span> <span class="o">=</span> <span class="n">widgetColorMath</span><span class="o">.</span><span class="n">OPERATION_FREQ_COUNT</span><span class="p">[</span><span class="n">operation_index</span><span class="p">]</span>

        <span class="n">freq_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Operating frequency LOCATION 1</span>
            <span class="n">oploc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">freq_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Operating frequency LOCATIONS</span>
            <span class="n">oploc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span><span class="p">)</span>
            <span class="n">oploc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq2</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">freq_set</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">num_freq_needed</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

            <span class="c1"># Operating frequency LOCATIONS</span>
            <span class="n">oploc1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span><span class="p">)</span>
            <span class="n">oploc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq2</span><span class="p">)</span>
            <span class="n">oploc3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">get_index_of_closest_freq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq3</span><span class="p">)</span>

            <span class="c1"># All frequencies set</span>
            <span class="n">freq_set</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">freq_set</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">):</span>  <span class="c1"># Return just a plane</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeak</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                  <span class="n">oploc1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>
                <span class="c1">#self.updateImgColorMinMax()</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>  <span class="c1"># Addition</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakAdd</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                     <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>
                <span class="c1">#self.updateImgColorMinMax()</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>  <span class="c1"># Subtraction</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMinus</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                       <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>
                <span class="c1">#self.updateImgColorMinMax()</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>  <span class="c1"># Multiplication</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakMultiply</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                          <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>
                <span class="c1">#self.updateImgColorMinMax()</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="c1"># Division</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakDivide</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                        <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>
                <span class="c1">#self.updateImgColorMinMax()</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;SUM&#39;</span><span class="p">:</span>  <span class="c1"># Division</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakSummation</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                           <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>
                <span class="c1">#self.updateImgColorMinMax()</span>
            <span class="k">elif</span> <span class="n">operation_text</span> <span class="o">==</span> <span class="s1">&#39;Peak b/w troughs&#39;</span><span class="p">:</span>  <span class="c1"># Division</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">*</span> \
                    <span class="n">_peakamps</span><span class="o">.</span><span class="n">MeasurePeakBWTroughs</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">,</span>
                                                           <span class="n">oploc1</span><span class="p">,</span> <span class="n">oploc2</span><span class="p">,</span>
                                                           <span class="n">oploc3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>
                <span class="c1">#self.updateImgColorMinMax()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setOpFreq1"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setOpFreq1">[docs]</a>    <span class="k">def</span> <span class="nf">setOpFreq1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math frequency #1 (the primary frequency)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq1</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">changeColor</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">()</span></div>


<div class="viewcode-block" id="CRIkitUI_process.setOpFreq2"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setOpFreq2">[docs]</a>    <span class="k">def</span> <span class="nf">setOpFreq2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math frequency #2 (e.g., freq #1 + freq #2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq2</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq2</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setOpFreq3"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setOpFreq3">[docs]</a>    <span class="k">def</span> <span class="nf">setOpFreq3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math frequency #3 (e.g., Amplitude at freq #1 - interpolation [freq #2, freq #3])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">opfreq3</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonOpFreq3</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setCondFreq1"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setCondFreq1">[docs]</a>    <span class="k">def</span> <span class="nf">setCondFreq1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math conditional frequency #1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq1</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setCondFreq2"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setCondFreq2">[docs]</a>    <span class="k">def</span> <span class="nf">setCondFreq2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math conditional frequency #2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq2</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq2</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.setCondFreq3"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.setCondFreq3">[docs]</a>    <span class="k">def</span> <span class="nf">setCondFreq3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color math conditional frequency #1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">currentfreq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">condfreq3</span> <span class="o">=</span> <span class="n">currentfreq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButtonCondFreq3</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">currentfreq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.spectrumColorImg"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.spectrumColorImg">[docs]</a>    <span class="k">def</span> <span class="nf">spectrumColorImg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate plot of mean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Which RGB image is it</span>
        <span class="n">rgbnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="n">Mask</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Mask</span> <span class="o">*=</span> <span class="n">Mask</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setmin</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Mask</span> <span class="o">*=</span> <span class="n">Mask</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">[</span><span class="n">rgbnum</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setmax</span>

        <span class="k">if</span> <span class="n">Mask</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">Mask</span> <span class="o">=</span> <span class="n">Mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>

            <span class="n">mask_hits</span> <span class="o">=</span> <span class="n">Mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1">#            print(&#39;Mask hits: {}&#39;.format(mask_hits))</span>

            <span class="n">mloc</span><span class="p">,</span> <span class="n">nloc</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Mask</span><span class="p">)</span>
<span class="c1">#            print(mloc, nloc)</span>

            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mean_spect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">[</span><span class="n">mloc</span><span class="p">,</span> <span class="n">nloc</span><span class="p">,</span> <span class="p">:][:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">std_spect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">[</span><span class="n">mloc</span><span class="p">,</span> <span class="n">nloc</span><span class="p">,</span> <span class="p">:][:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">#                print(mean_spect.shape)</span>
                <span class="c1"># Plot mean spectrum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">mean_spect</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean spectrum (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mask_hits</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">mask_hits</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="c1">#                print(mloc)</span>
<span class="c1">#                print(nloc)</span>
                <span class="n">mean_spect</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">[</span><span class="n">mloc</span><span class="p">,</span><span class="n">nloc</span><span class="p">,:])[</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_range_pix</span><span class="p">]</span>
<span class="c1">#                print(mean_spect.shape)</span>
                <span class="n">std_spect</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># Plot spectrum</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">mean_spect</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Spectrum (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mask_hits</span><span class="p">))</span>


            <span class="c1"># Check color of line b/c uses color cycler-- for fill_b/w</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">list_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">style_dict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>

            <span class="c1"># Alternative</span>
            <span class="c1">#color = self.plotter.modelLine._model_data[-1][&#39;color&#39;]</span>

            <span class="c1"># Plot +-1 std. dev.</span>
            <span class="k">if</span> <span class="n">mask_hits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">mean_spect</span> <span class="o">-</span> <span class="n">std_spect</span><span class="p">,</span>
                                          <span class="n">mean_spect</span> <span class="o">+</span> <span class="n">std_spect</span><span class="p">,</span>
                                          <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                                          <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\pm$1 Std. Dev. (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mask_hits</span><span class="p">))</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>


<div class="viewcode-block" id="CRIkitUI_process.createImgBW"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.createImgBW">[docs]</a>    <span class="k">def</span> <span class="nf">createImgBW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the single-frequency grayscale image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xunits</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">yunits</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">winextent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">createImg</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">xunits</span><span class="o">=</span><span class="n">xunits</span><span class="p">,</span>
                              <span class="n">yunits</span><span class="o">=</span><span class="n">yunits</span><span class="p">,</span>
                              <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">showcbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">axison</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">_mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkBoxFixed</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditMax</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">maxer</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditMin</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">minner</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CRIkitUI_process.changeSlider"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.changeSlider">[docs]</a>    <span class="k">def</span> <span class="nf">changeSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to change in frequency slider</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get current axis limits to reset to these</span>
        <span class="c1"># after refresh is performed</span>
        <span class="n">orig_axis_lims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">sliderPosition</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;Slider position need be an integer&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_list_pix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">op_list_pix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditPix</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEditFreq</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span><span class="mi">2</span><span class="p">)))</span>
            <span class="c1"># Set BW Class Data</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grayscaleimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">data_imag_over_real</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">pos</span><span class="o">+</span><span class="n">offset</span><span class="p">]</span>

            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

            <span class="c1"># print(&#39;Xlabel: {}&#39;.format(xlabel))</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkBoxFixed</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setmax</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setmin</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">createImgBW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

            <span class="c1"># Set axis to original limits</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="n">orig_axis_lims</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in changeSlider: display img_BW&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_overlays</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

                    <span class="n">color</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
                    <span class="n">mfc</span> <span class="o">=</span> <span class="n">color</span>  <span class="c1"># Marker face color</span>
                    <span class="n">mec</span> <span class="o">=</span> <span class="n">color</span>  <span class="c1"># Marker edge color</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span>  <span class="c1"># Linewidth</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                    <span class="n">ls</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span>  <span class="c1"># Linestyle</span>
                    <span class="n">ms</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;markersize&#39;</span><span class="p">]</span>  <span class="c1"># Markersize</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
                    <span class="n">marker</span> <span class="o">=</span> <span class="n">ol</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span>

                    <span class="c1"># Need some sort of marker if just a point</span>
                    <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">marker</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                                <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                                            <span class="n">mfc</span><span class="o">=</span><span class="n">mfc</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="n">mec</span><span class="p">,</span>
                                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span>
                                            <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                                            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowOverlayLegend</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">pass</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in changeSlider: display overlays&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcpre</span><span class="o">.</span><span class="n">backed_flag</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionUndo</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="CRIkitUI_process.sliderPressed"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.sliderPressed">[docs]</a>    <span class="k">def</span> <span class="nf">sliderPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to press of frequency slider (set tracking of location)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setTracking</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.sliderReleased"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.sliderReleased">[docs]</a>    <span class="k">def</span> <span class="nf">sliderReleased</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to release of frequency slider (end tracking of location)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">freqSlider</span><span class="o">.</span><span class="n">setTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CRIkitUI_process.checkCompositeUpdate"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.checkCompositeUpdate">[docs]</a>    <span class="k">def</span> <span class="nf">checkCompositeUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update color composite only if appropriate tab is selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabColors</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doComposite</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.doComposite"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.doComposite">[docs]</a>    <span class="k">def</span> <span class="nf">doComposite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update color composite image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">initData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">)</span>

            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">xlabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

            <span class="c1"># print(&#39;Xlabel: {}&#39;.format(xlabel))</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y_rep</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">createImg</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">,</span>
                                         <span class="n">xunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xunits</span><span class="p">,</span>
                                         <span class="n">yunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">yunits</span><span class="p">,</span>
                                         <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">winextent</span><span class="p">,</span>
                                         <span class="n">showcbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axison</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">initData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_RGB_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hsi</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">createImg</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">,</span>
                                          <span class="n">xunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xunits</span><span class="p">,</span>
                                          <span class="n">yunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">yunits</span><span class="p">,</span>
                                          <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_BW</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">winextent</span><span class="p">,</span>
                                          <span class="n">showcbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axison</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_Composite2</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="c1">#        self.img_Composite.mpl.draw()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="CRIkitUI_process.updateOverlays"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.updateOverlays">[docs]</a>    <span class="k">def</span> <span class="nf">updateOverlays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">list_line_objs</span><span class="p">:</span>
            <span class="n">ms</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">model_style</span>

            <span class="c1"># Make sure there is the appropriate meta data</span>
            <span class="k">if</span> <span class="n">ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overlay&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ms</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="s1">&#39;overlay&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.deleteOverlays"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.deleteOverlays">[docs]</a>    <span class="k">def</span> <span class="nf">deleteOverlays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateOverlays</span><span class="p">()</span></div>

<div class="viewcode-block" id="CRIkitUI_process.checkShowOverlays"><a class="viewcode-back" href="../../crikit.html#crikit.CRIkitUI.CRIkitUI_process.checkShowOverlays">[docs]</a>    <span class="k">def</span> <span class="nf">checkShowOverlays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_overlays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionShowOverlays</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeSlider</span><span class="p">()</span></div></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">_QApplication</span><span class="p">(</span><span class="n">_sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="s1">&#39;Cleanlooks&#39;</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setQuitOnLastWindowClosed</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">_QWidget</span><span class="p">()</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">CRIkitUI_process</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span> <span class="c1">### EDIT ###</span>

    <span class="c1"># Insert other stuff to do</span>


    <span class="c1"># Final stuff</span>
    <span class="n">win</span><span class="o">.</span><span class="n">showMaximized</span><span class="p">()</span>
    <span class="c1">#win.plotter.lower()</span>
    <span class="c1">#win.raise_()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
<span class="c1">#    _sys.exit(app.exec_())</span>
    <span class="c1">#app.closeAllWindows()</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'17.10b1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>